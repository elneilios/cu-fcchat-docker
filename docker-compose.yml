services:
  phpbb:
    build: .
    container_name: phpbb
    ports:
      - "8080:80"
    volumes:
      - ./phpbb:/var/www/html                      # phpBB source
      - ./config/docker.config.php:/tmp/docker.config.php:ro  # Docker config source (temporary location)
      - phpbb_data_uploads:/var/www/html/files     # uploads (persistent)
      - phpbb_data_cache:/var/www/html/cache       # cache (persistent)
      - phpbb_data_sessions:/var/www/html/store    # sessions/temp files
    depends_on:
      - db
    environment:
      APACHE_SERVER_NAME: localhost
      APACHE_SERVER_PORT: 8080

  db:
    image: mysql:5.6
    container_name: phpbb-db
    environment:
      MYSQL_ROOT_PASSWORD: rootpassword
      MYSQL_DATABASE: phpbb
      MYSQL_USER: phpbbuser
      MYSQL_PASSWORD: phpbbpass
    volumes:
      - ./db_init:/docker-entrypoint-initdb.d
      - phpbb_db_data:/var/lib/mysql
    command: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

volumes:
  phpbb_data_uploads:
  phpbb_data_cache:
  phpbb_data_sessions:
  phpbb_db_data:
