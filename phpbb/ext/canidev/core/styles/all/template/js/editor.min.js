/**
 * @package cBB Core
 * @version 1.1.10 24/02/2025
 *
 * @copyright (c) 2025 CaniDev
 * @license https://creativecommons.org/licenses/by-nc/4.0/
 */
(ve=>{function n(e,t){return typeof t===e}var ye=n.bind(null,"string"),Ye=n.bind(null,"undefined"),be=n.bind(null,"function");function o(e){return!Object.keys(e).length}function Ge(e,t){return $.extend.apply($,arguments)}function Ze(e,t){t=e.indexOf(t);-1<t&&e.splice(t,1)}function we(e,t){$.each(e,t)}n.bind(null,"number");var i={},xe=1,Ce=3,Se={never:0,auto:1,always:2,horizontal:3,vertical:4};function r(e){return e=parseFloat(e),isFinite(e)?e:0}function Ee(e,t,n){var o=(n||document).createElement(e);return we(t||{},function(e,t){"style"===e?o.style.cssText=t:e in o?o[e]=t:o.setAttribute(e,t)}),o}function Je(e,t){for(var n=e||{};(n=n.parentNode)&&!/(9|11)/.test(n.nodeType);)if(!t||Ve(n,t))return n}function Te(e,t){return Ve(e,t)?e:Je(e,t)}function ke(e){e.parentNode&&e.parentNode.removeChild(e)}function Me(e,t){e.appendChild(t)}function Ne(e,t){return e.querySelectorAll(t)}function De(n,e,o,r,i){e.split(" ").forEach(function(e){var t;ye(o)?(t=r["_sce-event-"+e+o]||function(e){for(var t=e.target;t&&t!==n;){if(Ve(t,o))return void r.call(t,e);t=t.parentNode}},r["_sce-event-"+e+o]=t):(t=o,i=r),n.addEventListener(e,t,i||!1)})}function He(n,e,o,r,i){e.split(" ").forEach(function(e){var t;ye(o)?t=r["_sce-event-"+e+o]:(t=o,i=r),n.removeEventListener(e,t,i||!1)})}function ze(e,t,n){if(arguments.length<3)return e.getAttribute(t);null==n?Re(e,t):e.setAttribute(t,n)}function Re(e,t){e.removeAttribute(t)}function Oe(e){Ie(e,"display","none")}function Qe(e){Ie(e,"display","")}function et(e){(ot(e)?Oe:Qe)(e)}function Ie(n,e,t){if(arguments.length<3){if(ye(e))return 1===n.nodeType?getComputedStyle(n)[e]:null;we(e,function(e,t){Ie(n,e,t)})}else{null===n&&console.trace();var o=(t||0===t)&&!isNaN(t);n.style[e]=o?t+"px":t}}function tt(e,t,n){var o=arguments.length,r={};if(e.nodeType===xe)return 1===o?(we(e.attributes,function(e,t){/^data\-/i.test(t.name)&&(r[t.name.substr(5)]=t.value)}),r):2===o?ze(e,"data-"+t):void ze(e,"data-"+t,String(n))}function Ve(e,t){var n=!1;return n=e&&e.nodeType===xe?(e.matches||e.msMatchesSelector||e.webkitMatchesSelector).call(e,t):n}function _e(e,t){t.parentNode.insertBefore(e,t)}function a(e){return e.className.trim().split(/\s+/)}function Be(e,t){return Ve(e,"."+t)}function Le(e,t){var n=a(e);n.indexOf(t)<0&&n.push(t),e.className=n.join(" ")}function We(e,t){var n=a(e);Ze(n,t),e.className=n.join(" ")}function Ae(e,t,n){((n=Ye(n)?!Be(e,t):n)?Le:We)(e,t)}function Pe(e,t){var n,o;if(Ye(t))return n=r((o=getComputedStyle(e)).paddingLeft)+r(o.paddingRight),o=r(o.borderLeftWidth)+r(o.borderRightWidth),e.offsetWidth-n-o;Ie(e,"width",t)}function $e(e,t){var n,o;if(Ye(t))return n=r((o=getComputedStyle(e)).paddingTop)+r(o.paddingBottom),o=r(o.borderTopWidth)+r(o.borderBottomWidth),e.offsetHeight-n-o;Ie(e,"height",t)}function nt(e,t,n){var o;be(window.CustomEvent)?o=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n}):(o=e.ownerDocument.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,n),e.dispatchEvent(o)}function ot(e){return e.getClientRects().length}function rt(e,t,n,o,r){for(e=r?e.lastChild:e.firstChild;e;){var i=r?e.previousSibling:e.nextSibling;if(!n&&!1===t(e)||!o&&!1===rt(e,t,n,o,r)||n&&!1===t(e))return!1;e=i}}function it(e,t,n,o){rt(e,t,n,o,!0)}function at(e,t){var n=(t=t||document).createDocumentFragment(),o=Ee("div",{},t);for(o.innerHTML=e;o.firstChild;)Me(n,o.firstChild);return n}function ct(e){return e&&(!Ve(e,"p,div")||e.className||ze(e,"style")||!o(tt(e)))}function st(e,t){var n=Ee(t,{},e.ownerDocument);for(we(e.attributes,function(e,t){try{ze(n,t.name,t.value)}catch(e){}});e.firstChild;)Me(n,e.firstChild);return e.parentNode.replaceChild(n,e),n}var c="|body|hr|p|div|h1|h2|h3|h4|h5|h6|address|pre|form|table|tbody|thead|tfoot|th|tr|td|li|ol|ul|blockquote|center|";function lt(e){return!!/11?|9/.test(e.nodeType)&&"|iframe|area|base|basefont|br|col|frame|hr|img|input|wbr|isindex|link|meta|param|command|embed|keygen|source|track|object|".indexOf("|"+e.nodeName.toLowerCase()+"|")<0}function qe(e,t){var n=(e||{}).nodeType||Ce;return n!==xe?n===Ce:"code"===(n=e.tagName.toLowerCase())?!t:c.indexOf("|"+n+"|")<0}function s(e,t){t.style.cssText=e.style.cssText+t.style.cssText}function ut(e){rt(e,function(e){var t,n,o,r=!qe(e,!0);r&&qe(e.parentNode,!0)&&(o=l(t=(e=>{for(;qe(e.parentNode,!0);)e=e.parentNode;return e})(e),e),s(t,n=e),_e(o,t),_e(n,t)),r&&Ve(e,"ul,ol")&&Ve(e.parentNode,"ul,ol")&&(o="li",n=(n=e).previousElementSibling,(t=!o||!n||Ve(n,o)?n:null)||_e(t=Ee("li"),e),Me(t,e))})}function u(e,t){return e?(t?e.previousSibling:e.nextSibling)||u(e.parentNode,t):null}function dt(e){var t,n,o,r,i,a,c=Ie(e,"whiteSpace"),s=/line$/i.test(c),l=e.firstChild;if(!/pre(\-wrap)?$/i.test(c))for(;l;){if(i=l.nextSibling,t=l.nodeValue,(n=l.nodeType)===xe&&l.firstChild&&dt(l),n===Ce){for(n=u(l),o=u(l,!0),a=!1;Be(o,"sceditor-ignore");)o=u(o,!0);if(qe(l)&&o){for(r=o;r.lastChild;)for(r=r.lastChild;Be(r,"sceditor-ignore");)r=u(r,!0);a=r.nodeType===Ce?/[\t\n\r ]$/.test(r.nodeValue):!qe(r)}t=(t=t.replace(/(\u200B)/g,"")).replace(/\u00a0/g," "),o&&qe(o)&&!a||(t=t.replace(s?/^[\t ]+/:/^[\t\n\r ]+/,"")),(t=n&&qe(n)?t:t.replace(s?/[\t ]+$/:/[\t\n\r ]+$/,"")).length?l.nodeValue=t.replace(s?/[\t ]+/g:/[\t\n\r ]+/g," "):ke(l)}l=i}}function l(e,t){var n=e.ownerDocument.createRange();return n.setStartBefore(e),n.setEndAfter(t),n.extractContents()}function ft(e){for(var t=0,n=0;e;)t+=e.offsetLeft,n+=e.offsetTop,e=e.offsetParent;return{left:t,top:n}}function d(e,t){var n,o=e.style;if(i[t]||(i[t]=t.replace(/^-ms-/,"ms-").replace(/-(\w)/g,function(e,t){return t.toUpperCase()})),n=o[t=i[t]],"textAlign"===t){if(o=o.direction,n=n||Ie(e,t),Ie(e.parentNode,t)===n||"block"!==Ie(e,"display")||Ve(e,"hr,th"))return"";if(/right/i.test(n)&&"rtl"===o||/left/i.test(n)&&"ltr"===o)return""}return n}var f,e,pt={toolbar:["bold","italic","underline","|","size","color","removeformat","|","bulletlist","orderedlist","|","code","quote","|","image","link","unlink","|","date","time","|","print","maximize","source"],fonts:"Arial,Arial Black,Comic Sans MS,Courier New,Georgia,Impact,Sans-serif,Serif,Times New Roman,Trebuchet MS,Verdana",charset:"utf-8",emoticonsCompat:!1,emoticonsEnabled:!0,emoticonsRoot:"",emoticons:{dropdown:{},more:{},hidden:{}},width:null,height:null,resize:Se.auto,resizeMinWidth:null,resizeMinHeight:null,resizeMaxHeight:null,resizeMaxWidth:null,resizeHeight:!0,resizeWidth:!0,dateFormat:"year-month-day",toolbarContainer:null,enablePasteFiltering:!1,disablePasting:!1,readOnly:!1,rtl:!1,autofocus:!1,autofocusEnd:!0,autoExpand:!1,autoUpdate:!1,spellcheck:!0,runWithoutWysiwygSupport:!1,startInSourceMode:!1,id:null,zIndex:null,bbcodeTrim:!1,disableBlockRemove:!1,parserOptions:{},fontSizes:{50:"Extra small",85:"Small",100:"Normal",150:"Large",200:"Huge"}},t=navigator.userAgent,p=ve.browser.msie?ve.browser.version:void 0,mt="-ms-ime-align"in document.documentElement.style,ht="ios"==ve.browser.os,gt=((e=document.createElement("div")).contentEditable=!0,"contentEditable"in document.documentElement&&"true"===e.contentEditable&&(e=/Opera Mobi|Opera Mini/i.test(t),/Android/i.test(t)&&(e=!0,/Safari/.test(t))&&(e=!(f=/Safari\/(\d+)/.exec(t))||!f[1]||f[1]<534),/ Silk\//i.test(t)&&(e=!(f=/AppleWebKit\/(\d+)/.exec(t))||!f[1]||f[1]<534),ht&&(e=/OS [0-4](_\d)+ like Mac/i.test(t)),/Firefox/i.test(t)&&(e=!1),/OneBrowser/i.test(t)&&(e=!1),"UCWEB"===navigator.vendor&&(e=!1),!(e=p<=9?!0:e))),m=/^(https?|s?ftp|mailto|spotify|skype|ssh|teamspeak|tel):|(\/\/)|data:image\/(png|bmp|gif|p?jpe?g);/i;function vt(e){return e.replace(/([\-.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}function yt(e,t){var n;return e&&(!(n={"&":"&amp;","<":"&lt;",">":"&gt;","  ":"&nbsp; ","\r\n":"<br />","\r":"<br />","\n":"<br />"})!==t&&(n['"']="&#34;",n["'"]="&#39;",n["`"]="&#96;"),e=e.replace(/ {2}|\r\n|[&<>\r\n'"`]/g,function(e){return n[e]||e})),e}var h={html:'<!DOCTYPE html><html<%attrs%>><head><style>.ie * {min-height: auto !important} .ie table td {height:15px} @supports (-ms-ime-align:auto) { * { min-height: auto !important; } }</style><meta http-equiv="Content-Type" content="text/html;charset=<%charset%>" /></head><body contenteditable="true" <%spellcheck%>><p></p></body></html>',toolbarButton:'<a class="sceditor-button sceditor-button-<%name%>" data-sceditor-command="<%name%>" unselectable="on"><div unselectable="on"><%dispName%></div></a>',emoticon:'<img src="<%url%>" data-sceditor-emoticon="<%key%>" alt="<%key%>" title="<%tooltip%>" />',sizeOpt:'<li><a href="#" data-size="<%size%>"><%label%></a></li>'};function bt(e,t,n){var o=ve.template.get("editor-"+e,t);return o||void 0===h[e]||(o=ve.template.parse(h[e],t)),n?at(o):o}var g=p&&p<11;function v(e){if("mozHidden"in document)for(var t,n=e.getBody();n;){if((t=n).firstChild)t=t.firstChild;else{for(;t&&!t.nextSibling;)t=t.parentNode;t=t&&t.nextSibling}3!==n.nodeType||!/[\n\r\t]+/.test(n.nodeValue)||/^pre/.test(Ie(n.parentNode,"whiteSpace"))||ke(n),n=t}}var Fe={bold:{exec:"bold",tooltip:"Bold",shortcut:"Ctrl+B"},italic:{exec:"italic",tooltip:"Italic",shortcut:"Ctrl+I"},underline:{exec:"underline",tooltip:"Underline",shortcut:"Ctrl+U"},size:{_dropDown:function(t,e,n){var o=Ee("ul");o.className="cbb-menu",we(t.opts.fontSizes,function(e,t){Me(o,bt("sizeOpt",{label:t,size:e},!0))}),De(o,"click","a",function(e){n(tt(this,"size")),t.closeDropDown(!0),e.preventDefault()}),t.createDropDown(e,"fontsize-picker",o)},exec:function(e){var t=this;Fe.size._dropDown(t,e,function(e){t.wysiwygEditorInsertHtml('<span data-size="'+e+'" style="font-size:'+e+'%;">',"</span>")})},tooltip:"Font Size"},color:{_dropDown:function(e,t,n){var o,r=e.inSourceMode();r||(o=e.getRangeHelper().parentNode().ownerDocument.queryCommandValue("forecolor")),e.createDropDown(t,"color-picker",function(e){return $(e).cbbColorPicker({showOnCreate:!0,color:o,realTimeUpdate:!r,onChange:n})})},exec:function(e){var t=this;Fe.color._dropDown(t,e,function(e){t.execCommand("forecolor",e)})},tooltip:"Font Color"},removeformat:{exec:function(){this.execCommand("removeformat");var e,t=this.getRangeHelper().selectedHtml(),n=this.getRangeHelper().getFirstBlockParent();t&&(t=this.wrapper.clearBBcode(t),this.getRangeHelper().containsNodeText(n)?((e=document.createElement("span")).innerHTML=t,n.parentNode.replaceChild(e,n)):this.wysiwygEditorInsertHtml(t))},tooltip:"REMOVE_FORMAT"},bulletlist:{exec:function(){v(this),this.execCommand("insertunorderedlist")},tooltip:"Bullet list"},orderedlist:{exec:function(){v(this),this.execCommand("insertorderedlist")},tooltip:"Numbered list"},code:{exec:function(){this.wysiwygEditorInsertHtml('<code data-title="'+ve.lang("CODE")+':">',(g?"":"<br />")+"</code>")},tooltip:"CODE"},image:{_dropDown:function(e,t,n){e.createDropDown(t,"insertimage",e.wrapper.getTemplate("imgMenu"),n)},exec:function(e){var t=this;Fe.image._dropDown(t,e,function(e){if(e.link)return t.wysiwygEditorInsertHtml('<img src="'+e.link+'" />'),!0})},tooltip:"Insert an image"},link:{_dropDown:function(e,t,n){e.createDropDown(t,"insertlink",e.wrapper.getTemplate("urlMenu"),n)},exec:function(e){var t=this;Fe.link._dropDown(t,e,function(e){if(e.link)return t.focus(),e.desc||!t.getRangeHelper().selectedHtml()?(e.desc=e.desc||e.link,t.wysiwygEditorInsertHtml('<a href="'+e.link+'">'+e.desc+"</a>")):t.execCommand("createlink",e.link),!0})},tooltip:"Insert a link"},unlink:{state:function(){return Te(this.currentNode(),"a")?0:-1},exec:function(){var e=Te(this.currentNode(),"a");if(e){for(;e.firstChild;)_e(e.firstChild,e);ke(e)}},tooltip:"UNLINK"},quote:{_dropDown:function(e,t,n){e.createDropDown(t,"insertquote",e.wrapper.getTemplate("quoteMenu"),n)},exec:function(e,t,n){var r=this;Fe.quote._dropDown(r,e,function(e){var t,n="</blockquote>",o={};return""===r.getRangeHelper().selectedHtml()&&(n=(g?"":"<br />")+n),o["data-author"]=e.author,e.author||(o.class="uncited"),e.date&&(t=new Date(e.date),o["data-time"]=Math.floor(t.getTime()/1e3),o["data-time-formatted"]=t.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"})),t=ve.template.parse("<blockquote <%attrs%>><%author%>",{attrs:ve.serializeVars(o," "),author:e.author?"<cite>"+e.author+"</cite>":""}),r.wysiwygEditorInsertHtml(t,n),!0})}},date:{_date:function(e){var t=new Date,n=t.getYear(),o=t.getMonth()+1,t=t.getDate();return o<10&&(o="0"+o),t<10&&(t="0"+t),e.opts.dateFormat.replace(/year/i,n=n<2e3?1900+n:n).replace(/month/i,o).replace(/day/i,t)},exec:function(){this.insertText(Fe.date._date(this))},txtExec:function(){this.insertText(Fe.date._date(this))},tooltip:"Insert current date"},time:{_time:function(){var e=new Date,t=e.getHours(),n=e.getMinutes(),e=e.getSeconds();return(t=t<10?"0"+t:t)+":"+(n=n<10?"0"+n:n)+":"+(e=e<10?"0"+e:e)},exec:function(){this.insertText(Fe.time._time())},txtExec:function(){this.insertText(Fe.time._time())},tooltip:"Insert current time"},print:{exec:"print",tooltip:"PRINT"},maximize:{state:function(){return this.maximize()},exec:function(){this.maximize(!this.maximize())},txtExec:function(){this.maximize(!this.maximize())},tooltip:"MAXIMIZE",shortcut:"Ctrl+Shift+M"},source:{state:function(){return this.sourceMode()},exec:function(){this.toggleSourceMode()},txtExec:function(){this.toggleSourceMode()},tooltip:"VIEW_SOURCE",shortcut:"Ctrl+Shift+S"},ignore:{}},Ue=window,je=document,Ke=p,wt=Ke&&Ke<11;function Xe(r,n,B){var a,w,u,i,c,f,d,s,l,p,m,h,g,v,y,b,L,W,t,o,x,A,C,S,e,E,P,q,F,U,j,K,X,Y,G,Z,J,Q,ee,te,ne,oe,re,ie,T,ae,k,ce,M,se,le,ue,de,fe,pe,N,me,D,he,H,z=this,R={},O=[],I={},ge={},V={},_=(z.commands=Ge(!0,{},n.commands||Fe),z.opts=Ge(!0,{},pt,n));z.opts.emoticons=n.emoticons||pt.emoticons,e=function(){(r._sceditor=z).wrapper=B,n.toolbar&&(_.toolbar=n.toolbar),_e(w=Ee("div",{className:"sceditor-container"}),r),Ie(w,"z-index",_.zIndex),Oe(w),Ke&&Le(w,"ie ie"+Ke),W=r.required,r.required=!1;function e(){He(Ue,"load",e),_.autofocus&&ue(),H(),M(),z.wrapper.triggerEvent("sceditorReady"),"onReady"in a&&a.onReady.call(z)}var t=Xe.formats[_.format];"init"in(a=t?new t:{})&&a.init.call(z),Y(),U(),F(),j(),K(),gt||z.toggleSourceMode(),k();De(Ue,"load",e),"complete"===je.readyState&&e()},F=function(){s=Ee("textarea"),i=Ee("iframe",{frameborder:0,allowfullscreen:!0}),_.startInSourceMode?(Le(w,"sourceMode"),Oe(i)):(Le(w,"wysiwygMode"),Oe(s)),_.spellcheck||ze(w,"spellcheck","false"),"https:"===Ue.location.protocol&&ze(i,"src","javascript:false"),Me(w,i),Me(w,s),z.dimensions(_.width||Pe(r),_.height||$e(r)+$e(u)),Qe(w);var e=Ke?"ie ie"+Ke:"",e=(e+=ht?" ios":"",(d=i.contentDocument).open(),d.write(bt("html",{attrs:' class="'+e+'"',spellcheck:_.spellcheck?"":'spellcheck="false"',charset:_.charset})),d.close(),f=d.body,c=i.contentWindow,z.readOnly(!!_.readOnly),(ht||mt||Ke)&&($e(f,"100%"),Ke||De(f,"touchend",z.focus)),ze(r,"tabindex")),e=(ze(s,"tabindex",e),ze(i,"tabindex",e),g=new sceditor.RangeHelper(c),Oe(r),z.val(r.value),_.placeholder||ze(r,"placeholder"));e&&(s.placeholder=e,ze(f,"placeholder",e))},j=function(){if(_.autoUpdate&&(De(f,"blur",he),De(s,"blur",he)),null===_.rtl&&(_.rtl="rtl"===Ie(s,"direction")),z.rtl(!!_.rtl),_.autoExpand&&(De(f,"load",H,!0),De(f,"input keyup",H)),_.resize==Se.auto)switch(Ie(r,"resize")){case"horizontal":_.resize=Se.horizontal;break;case"vertical":_.resize=Se.vertical;break;case"none":_.resize=Se.never;break;default:_.resize=Se.always}_.resize!=Se.never&&X(),ze(w,"id",_.id),z.emoticons(_.emoticonsEnabled)},K=function(){var e=r.form,t="compositionstart compositionend",n="keydown keyup keypress focus blur contextmenu",o="onselectionchange"in d?"selectionchange":"keyup focus blur contextmenu mouseup touchend click";De(je,"click",G),e&&(De(e,"reset",oe),De(e,"submit",z.updateOriginal,!0)),De(f,"keypress",ne),De(f,"keydown",ee),De(f,"keydown",te),De(f,"keyup",M),De(f,"blur",me),De(f,"keyup",D),De(f,"paste drop",J),De(f,t,ie),De(f,o,se),De(f,n,T),_.emoticonsCompat&&Ue.getSelection&&De(f,"keyup",fe),De(f,"blur",function(){z.val()||Le(f,"placeholder")}),De(f,"focus",function(){We(f,"placeholder")}),De(s,"blur",me),De(s,"keyup",D),De(s,"keydown",ee),De(s,"paste drop",J),De(s,t,ie),De(s,n,T),De(d,"mousedown",re),De(d,o,se),De(d,"beforedeactivate keyup mouseup",q),De(d,"keyup",M),De(d,"focus",function(){p=null}),De(w,"selectionchanged",le),De(w,"selectionchanged",k),De(w,"selectionchanged valuechanged nodechanged",T),De(w,"valuechanged nodechanged",Z)},U=function(){var a=[],c=z.commands;u=Ee("div",{className:"sceditor-toolbar",unselectable:"on"}),_.icons in Xe.icons&&(S=new Xe.icons[_.icons]),a.push(Ee("div",{className:"sceditor-group"})),we(_.toolbar,function(e,t){if("|"==t)return a.push(Ee("div",{className:"sceditor-group"})),!0;var n,o,r,i=c[t];i&&(o=i.shortcut,r=bt("toolbarButton",{name:t,dispName:ve.lang(i.name||i.tooltip||t)},!0).firstChild,S&&S.create&&(n=S.create(t))&&(_e(n,r.firstChild),Le(r,"has-icon")),r._sceTxtMode=!!i.txtExec,r._sceWysiwygMode=!1!==i.exec,Ae(r,"disabled",!1===i.exec),De(r,"click",function(e){Be(r,"disabled")||P(r,i),k(),e.preventDefault()}),De(r,"mousedown",function(e){e.preventDefault()}),i.tooltip&&ze(r,"title",ve.lang(i.tooltip)+(o?" ("+o+")":"")),o&&z.addShortcut(o,t),i.state?O.push({name:t,state:i.state}):ye(i.exec)&&"plain"!=i.exec&&O.push({name:t,state:i.exec}),Me(a[a.length-1],r),ge[t]=r)}),we(a,function(e,t){t.firstChild&&Me(u,t)}),Me(_.toolbarContainer||w,u)},X=function(){var e=Ee("div",{className:"sceditor-grip"}),t=Ee("div",{className:"sceditor-resize-cover"}),n="touchmove mousemove",o="touchcancel touchend mouseup",r=0,i=0,a=0,c=0,s=0,l=0,u=Pe(w),d=$e(w),f=!1,p=z.rtl(),m=_.resizeMinHeight||d/1.5,h=_.resizeMaxHeight||2.5*d,g=_.resizeMinWidth||u/1.25,v=_.resizeMaxWidth||1.25*u,y=function(e){c=("touchmove"===e.type?(e=Ue.event,a=e.changedTouches[0].pageX,e.changedTouches[0]):(a=e.pageX,e)).pageY;var t=l+(c-i),n=p?s-(a-r):s+(a-r);0<v&&v<n&&(n=v),0<g&&n<g&&(n=g),_.resizeWidth||(n=!1),0<h&&h<t&&(t=h),0<m&&t<m&&(t=m),_.resizeHeight||(t=!1),(n||t)&&z.dimensions(n,t),e.preventDefault()},b=function(e){f&&(f=!1,Oe(t),We(w,"resizing"),He(je,n,y),He(je,o,b),e.preventDefault())};S&&S.create&&(d=S.create("grip"))&&(Me(e,d),Le(e,"has-icon")),Me(w,e),Me(w,t),Oe(t),De(e,"touchstart mousedown",function(e){i=("touchstart"===e.type?(e=Ue.event,r=e.touches[0].pageX,e.touches[0]):(r=e.pageX,e)).pageY,s=Pe(w),l=$e(w),f=!0,_.resize==Se.horizontal?m=h=l:_.resize==Se.vertical&&(g=v=s),Le(w,"resizing"),Qe(t),De(je,n,y),De(je,o,b),e.preventDefault()})},Y=function(){var e=_.emoticons,n=_.emoticonsRoot||e.path||"";we(V=e?Ge({},e.more,e.dropdown,e.hidden):V,function(e,t){V[e]=bt("emoticon",{key:e,url:n+(t.url||t),tooltip:t.tooltip||e})})},ue=function(){var e,t=f.firstChild,n=!!_.autofocusEnd;if(ot(w))if(z.sourceMode())e=n?s.value.length:0,s.setSelectionRange(e,e);else{if(dt(f),n)for((t=f.lastChild)||(t=Ee("p",{},d),Me(f,t));t.lastChild;)t=t.lastChild,!wt&&Ve(t,"br")&&t.previousSibling&&(t=t.previousSibling);e=d.createRange(),lt(t)?e.selectNodeContents(t):(e.setStartBefore(t),n&&e.setStartAfter(t)),e.collapse(!n),g.selectRange(e),b=e,n&&(f.scrollTop=f.scrollHeight),z.focus()}},z.readOnly=function(e){return"boolean"!=typeof e?!s.readonly:(f.contentEditable=!e,s.readonly=!e,ae(e),z)},z.rtl=function(e){var t=e?"rtl":"ltr";return"boolean"!=typeof e?"rtl"===ze(s,"dir"):(ze(f,"dir",t),ze(s,"dir",t),We(w,"rtl"),We(w,"ltr"),Le(w,t),S&&S.rtl&&S.rtl(e),z)},ae=function(n){var o=z.inSourceMode()?"_sceTxtMode":"_sceWysiwygMode";we(ge,function(e,t){Ae(t,"disabled",n||!t[o])})},z.width=function(e,t){return e||0===e?(z.dimensions(e,null,t),z):Pe(w)},z.dimensions=function(e,t,n){return t=!(!t&&0!==t)&&t,!1===(e=!(!e&&0!==e)&&e)&&!1===t?{width:z.width(),height:z.height()}:(!1!==e&&(!1!==n&&(_.width=e),Pe(w,e)),!1!==t&&(!1!==n&&(_.height=t),$e(w,t)),z)},z.height=function(e,t){return e||0===e?(z.dimensions(null,e,t),z):$e(w)},z.maximize=function(e){var t="sceditor-maximize";return Ye(e)?Be(w,t):((e=!!e)&&(A=Ue.pageYOffset),Ae(je.documentElement,t,e),Ae(je.body,t,e),Ae(w,t,e),z.width(e?"100%":_.width,!1),z.height(e?"100%":_.height,!1),e||Ue.scrollTo(0,A),H(),z)},H=function(){_.autoExpand&&!x&&(x=setTimeout(z.expandToContent,200))},z.expandToContent=function(e){var t,n;z.maximize()||(clearTimeout(x),x=!1,o||(n=_.resizeMinHeight||_.height||$e(r),o={min:n,max:_.resizeMaxHeight||2*n}),(n=je.createRange()).selectNodeContents(f),n=n.getBoundingClientRect(),t=d.documentElement.clientHeight-1,n=n.bottom-n.top,n=z.height()+1+(n-t),e||-1===o.max||(n=Math.min(n,o.max)),z.height(Math.ceil(Math.max(n,o.min))))},z.destroy=function(){var e;g&&(p=g=null,z.closeDropDown(),He(je,"click",G),(e=r.form)&&(He(e,"reset",oe),He(e,"submit",z.updateOriginal)),ke(s),ke(u),ke(w),delete r._sceditor,Qe(r),r.required=W)},z.createDropDown=function(e,t,n,o){var r=!1;l&&l[0]==e&&(r=!0),z.closeDropDown(!0),r||("function"==typeof n?l=n.call(z,e):(l=$(e).cbbDropdown({dispatchEvent:!1,class:"editor-dropdown",selector:"auto",onOpen:function(){var t=this,e=$("<form></form>");e.append(n),this.setContent(e),t.container.find(".submit-buttons button").click(function(e){e.preventDefault();e=t.container.find("form").serializeObject();!0===o.call(t,e)&&t.close()}),ve.browser.msie&&this.container.find(":not(input):not(textarea)").each(function(){this.nodeType===xe&&ze(this,"unselectable","on")})}})).cbbDropdown("open"),l.cbbDropdown("setOption","onClose",function(){l=null}))},G=function(e){3===e.which||e.defaultPrevented||he()},Z=function(){var e=i.contentDocument,e=$(e).find(".interactive-box:not(.ignored)");e.length&&(e.find('.media-controls > a[data-action="remove"]').click(function(e){e.preventDefault(),ke(Te(this,".interactive-box")),le(),z.focus()}),e.each(function(){z.wrapper.triggerEvent("sceditorInteractiveActions",ze(this,"data-bbcode"),$(this))}),e.addClass("ignored"))},J=function(e){var t=f,n=e.clipboardData||e.dataTransfer;if(!n||(Ke||mt)&&!z.sourceMode()){if(!C&&!z.sourceMode()){var o=t.scrollTop;for(g.saveRange(),C=je.createDocumentFragment();t.firstChild;)Me(C,t.firstChild);setTimeout(function(){var e=t.innerHTML;t.innerHTML="",Me(t,C),t.scrollTop=o,C=!1,g.restoreRange(),Q({html:e})},0)}}else{var r={},i=n.types;n.items;e.preventDefault();for(var a=0;a<i.length;a++)r[i[a]]=n.getData(i[a]);r.text=r["text/plain"],r.html=r["text/html"],Q(r)}},Q=function(e){var t,n={};z.wrapper.triggerEvent("sceditorPasteRaw",e),z.sourceMode()?n.val=e.html||e.text:(t=Ee("div",{},d),nt(w,"pasteraw",e),e.html?(t.innerHTML=e.html,ut(t)):t.innerHTML=yt(e.text||""),n.val=t.innerHTML),"fragmentToSource"in a&&(n.val=a.fragmentToSource(n.val,d,v)),z.wrapper.triggerEvent("sceditorPaste",n),z.sourceMode()?z.sourceEditorInsertText(n.val,null):(nt(w,"paste",n),"fragmentToHtml"in a&&(n.val=a.fragmentToHtml(n.val,v)),z.wrapper.triggerEvent("sceditorPasteHtml",n),z.wysiwygEditorInsertHtml(n.val,null,!0))},z.closeDropDown=function(e){l&&l.cbbDropdown("close"),!0===e&&z.focus()},z.wysiwygEditorInsertHtml=function(e,t,n){var o=$e(i);return z.focus(),!(!n&&Te(y,"code")||(g.insertHTML(e,t),g.saveRange(),E(),Qe(n=Ne(f,"#sceditor-end-marker")[0]),e=f.scrollTop,t=ft(n).top+1.5*n.offsetHeight-o,Oe(n),(e<t||t+o<e)&&(f.scrollTop=t),N(!1),g.restoreRange(),M(),0))},z.wysiwygEditorInsertText=function(e,t){z.wysiwygEditorInsertHtml(yt(e),yt(t))},z.insertText=function(e,t){return z.inSourceMode()?z.sourceEditorInsertText(e,t):z.wysiwygEditorInsertText(e,t),z},z.sourceEditorInsertText=function(e,t){var n,o=s.selectionStart,r=s.selectionEnd,i=s.scrollTop;s.focus(),n=s.value,t&&(e+=n.substring(o,r)+t),s.value=n.substring(0,o)+e+n.substring(r,n.length),s.selectionStart=o+e.length-(t?t.length:0),s.selectionEnd=s.selectionStart,s.scrollTop=i,s.focus(),N()},z.getRangeHelper=function(){return g},z.sourceEditorCaret=function(e){return s.focus(),e?(s.selectionStart=e.start,s.selectionEnd=e.end,this):{start:s.selectionStart,end:s.selectionEnd}},z.val=function(e,t){return ye(e)?(z.inSourceMode()?z.setSourceEditorValue(e):(!1!==t&&"toHtml"in a&&(e=a.toHtml(e)),z.setWysiwygEditorValue(e)),z):z.inSourceMode()?z.getSourceEditorValue(!1):z.getWysiwygEditorValue(t)},z.insert=function(e,t,n,o,r){var i;return z.inSourceMode()?z.sourceEditorInsertText(e,t):(t&&(i=g.selectedHtml(),e+=(i=!1!==n&&"fragmentToSource"in a?a.fragmentToSource(i,d,v):i)+t),!1!==n&&"fragmentToHtml"in a&&(e=a.fragmentToHtml(e,v)),!1!==n&&!0===r&&(e=e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")),z.wysiwygEditorInsertHtml(e),null!==(i=e.match(/(\[\/[a-z0-9-_]+\])$/))&&(3!=(n=(t=this.getRangeHelper().selectedRange()).endContainer).nodeType&&(n=n.childNodes[t.endOffset-1]),t.setStart(n,n.nodeValue.indexOf(i[1])),t.collapse(!0))),z},z.getWysiwygEditorValue=function(e){for(var t,n=Ee("div",{},d),o=f.childNodes,r=0;r<o.length;r++)Me(n,o[r].cloneNode(!0));return Ne(n,"iframe").forEach(function(e){ke(e)}),Me(f,n),ut(n),ke(n),t=n.innerHTML,t=!1!==e&&a.hasOwnProperty("toSource")?a.toSource(t,d):t},z.getBody=function(){return f},z.getContentAreaContainer=function(){return i},z.getSource=function(){return s},z.getSourceEditorValue=function(e){var t=s.value;return t=!1!==e&&"toHtml"in a?a.toHtml(t):t},z.setWysiwygEditorValue=function(e){f.innerHTML=e=e||"<p>"+(Ke?"":"<br />")+"</p>",E(),M(),N(),H()},z.setSourceEditorValue=function(e){s.value=e,N()},z.updateOriginal=function(){r.value=z.val()},E=function(){var e,c,s,l,t,u,d;_.emoticonsEnabled&&(e=f,c=V,s=_.emoticonsCompat,l=e.ownerDocument,t="(^|\\s| | | | |$)",u=[],d={},Je(e,"code")||(we(c,function(e){d[e]=new RegExp(t+vt(e)+t),u.push(e)}),u.sort(function(e,t){return t.length-e.length}),function e(t){for(t=t.firstChild;t;){if(t.nodeType!==xe||Ve(t,"code")||e(t),t.nodeType===Ce)for(var n=0;n<u.length;n++){var o,r=t.nodeValue,i=u[n],a=s?r.search(d[i]):r.indexOf(i);-1<a&&(a=r.indexOf(i,a),o=at(c[i],l),i=r.substr(a+i.length),o.appendChild(l.createTextNode(i)),t.nodeValue=r.substr(0,a),t.parentNode.insertBefore(o,t.nextSibling))}t=t.nextSibling}}(e)))},z.inSourceMode=function(){return Be(w,"sourceMode")},z.sourceMode=function(e){var t=z.inSourceMode();return"boolean"!=typeof e?t:((t&&!e||!t&&e)&&z.toggleSourceMode(),z)},z.toggleSourceMode=function(){var e=z.inSourceMode();!gt&&e||(e||(g.saveRange(),g.clear()),z.blur(),e?z.setWysiwygEditorValue(z.getSourceEditorValue()):z.setSourceEditorValue(z.getWysiwygEditorValue()),p=null,et(s),et(i),Ae(w,"wysiwygMode",e),Ae(w,"sourceMode",!e),ae(),k())},ce=function(){return s.focus(),s.value.substring(s.selectionStart,s.selectionEnd)},P=function(e,t){z.inSourceMode()||"plain"==t.exec||Ye(t.exec)&&be(t.txtExec)?t.txtExec&&(Array.isArray(t.txtExec)?z.insert.apply(z,t.txtExec):t.txtExec.call(z,e,ce())):t.exec&&(be(t.exec)?t.exec.call(z,e):z.execCommand(t.exec,t.hasOwnProperty("execParam")?t.execParam:null))},q=function(){Ke&&(p=g.selectedRange())},z.execCommand=function(e,t){var n=!1,o=z.commands[e];if(z.focus(),!Te(g.parentNode(),"code")){try{n=d.execCommand(e,!1,t)}catch(e){}!n&&o&&o.errorMessage&&alert(ve.lang(o.errorMessage)),k()}},se=function(){function e(){if(c.getSelection()&&c.getSelection().rangeCount<=0)b=null;else if(g&&!g.compare(b)){if((b=g.cloneSelected())&&b.collapsed){var e=b.startContainer,t=b.startOffset;for(t&&e.nodeType!==Ce&&(e=e.childNodes[t]);e&&e.parentNode!==f;)e=e.parentNode;e&&qe(e,!0)&&(g.saveRange(),n=d,rt(f,function(e){qe(e,!0)?(o||_e(o=Ee("p",{},n),e),e.nodeType===Ce&&""===e.nodeValue||Me(o,e)):o=null},!1,!0),g.restoreRange())}nt(w,"selectionchanged")}var n,o;L=!1}L||(L=!0,"onselectionchange"in d?e():setTimeout(e,100))},le=function(){var e,t=g.parentNode();v!==t&&(e=v,v=t,y=g.getFirstBlockParent(t),nt(w,"nodechanged",{oldNode:e,newNode:v}))},z.currentNode=function(){return v},z.currentBlockNode=function(){return y},k=function(){var e,t,n="active",o=d,r=z.sourceMode();if(z.readOnly())we(Ne(u,n),function(e,t){We(t,n)});else{r||(t=g.parentNode(),e=g.getFirstBlockParent(t));for(var i=0;i<O.length;i++){var a=0,c=ge[O[i].name],s=O[i].state,l=r&&!c._sceTxtMode||!r&&!c._sceWysiwygMode;if(!l)if(ye(s)){if(!r)try{-1<(a=o.queryCommandEnabled(s)?0:-1)&&(a=o.queryCommandState(s)?1:0)}catch(e){}}else a=s.call(z,t,e,r);Ae(c,"disabled",l||a<0),Ae(c,n,0<a)}S&&S.update&&S.update(r,t,e)}},ne=function(e){var t,n,o;e.defaultPrevented||(z.closeDropDown(),13===e.which&&!Ve(y,"li,ul,ol")&&ct(y)&&(p=null,t=Ee("br",{},d),g.insertNode(t),wt||((o=(n=t.parentNode).lastChild)&&o.nodeType===Ce&&""===o.nodeValue&&(ke(o),o=n.lastChild),!qe(n,!0)&&o===t&&qe(t.previousSibling)&&g.insertHTML("<br>")),e.preventDefault()))},M=function(){it(f,function(e){var t;if(e.nodeType===xe&&!/inline/.test(Ie(e,"display"))&&(!Ve(e,".sceditor-nlf")&&ct(e)))return(t=Ee("p",{},d)).className="sceditor-nlf",t.innerHTML=wt?"":"<br />",Me(f,t),!1;if(3===e.nodeType&&!/^\s*$/.test(e.nodeValue)||Ve(e,"br"))return!1})},oe=function(){z.val(r.value)},re=function(){z.closeDropDown(),p=null},T=function(t){var e=t.type.charAt(0).toUpperCase()+t.type.slice(1),e=(z.wrapper.triggerEvent("sceditor"+e,t),(t.target===s?"scesrc":"scewys")+t.type);R[e]&&R[e].forEach(function(e){e.call(z,t)})},z.bind=function(e,t,n,o){for(var r,i,a=(e=e.split(" ")).length;a--;)be(t)&&(r="scewys"+e[a],i="scesrc"+e[a],n||(R[r]=R[r]||[],R[r].push(t)),o||(R[i]=R[i]||[],R[i].push(t)),"valuechanged"===e[a])&&(N.hasHandler=!0);return z},z.unbind=function(e,t,n,o){for(var r=(e=e.split(" ")).length;r--;)be(t)&&(n||Ze(R["scewys"+e[r]]||[],t),o||Ze(R["scesrc"+e[r]]||[],t));return z},z.blur=function(e,t,n){return be(e)?z.bind("blur",e,t,n):(z.sourceMode()?s:f).blur(),z},z.focus=function(e,t,n){if(be(e))z.bind("focus",e,t,n);else if(z.inSourceMode())s.focus();else{if(Ne(d,":focus").length)return;e=g.selectedRange();b||ue(),!wt&&e&&1===e.endOffset&&e.collapsed&&(t=e.endContainer)&&1===t.childNodes.length&&Ve(t.firstChild,"br")&&(e.setStartBefore(t.firstChild),e.collapse(!0),g.selectRange(e)),c.focus(),f.focus(),p&&(g.selectRange(p),p=null)}return k(),z},z.keyDown=function(e,t,n){return z.bind("keydown",e,t,n)},z.keyPress=function(e,t,n){return z.bind("keypress",e,t,n)},z.keyUp=function(e,t,n){return z.bind("keyup",e,t,n)},z.nodeChanged=function(e){return z.bind("nodechanged",e,!1,!0)},z.selectionChanged=function(e){return z.bind("selectionchanged",e,!1,!0)},z.valueChanged=function(e,t,n){return z.bind("valuechanged",e,t,n)},de=function(e){var n=0,o=z.emoticonsCache,t=String.fromCharCode(e.which);Te(y,"code")||(o||(o=[],we(V,function(e,t){o[n++]=[e,t]}),o.sort(function(e,t){return e[0].length-t[0].length}),z.emoticonsCache=o,z.longestEmoticonCode=o[o.length-1][0].length),!g.replaceKeyword(z.emoticonsCache,!0,!0,z.longestEmoticonCode,_.emoticonsCompat,t))||_.emoticonsCompat&&/^\s$/.test(t)||e.preventDefault()},fe=function(){var e=y,t=g,n=/[^\s\xA0\u2002\u2003\u2009\u00a0]+/,o=e&&Ne(e,"img[data-sceditor-emoticon]");if(e&&o.length)for(var r=0;r<o.length;r++){var i,a,c,s,l=o[r],u=l.parentNode,d=l.previousSibling,f=l.nextSibling;(d&&n.test(d.nodeValue.slice(-1))||f&&n.test((f.nodeValue||"")[0]))&&(a=-1,c=(i=t.cloneSelected()).startContainer,null===(s=d.nodeValue)&&(s=d.innerText||""),s+=tt(l,"sceditor-emoticon"),c===f&&(a=s.length+i.startOffset),c===e&&e.childNodes[i.startOffset]===f&&(a=s.length),c===d&&(a=i.startOffset),(f=f&&f.nodeType===Ce?f:u.insertBefore(u.ownerDocument.createTextNode(""),f)).insertData(0,s),ke(d),ke(l),-1<a)&&(i.setStart(f,a),i.collapse(!0),t.selectRange(i))}},z.emoticons=function(e){return e||!1===e?((_.emoticonsEnabled=e)?(De(f,"keypress",de),z.sourceMode()||(g.saveRange(),E(),N(!1),g.restoreRange())):(we(Ne(f,"img[data-sceditor-emoticon]"),function(e,t){var n=tt(t,"sceditor-emoticon"),n=d.createTextNode(n);t.parentNode.replaceChild(n,t)}),He(f,"keypress",de),N()),z):_.emoticonsEnabled},z.css=function(e){return t||(t=Ee("style",{id:"inline"},d),Me(d.head,t)),ye(e)?(t.styleSheet?t.styleSheet.cssText=e:t.innerHTML=e,z):t.styleSheet?t.styleSheet.cssText:t.innerHTML},ee=function(e){var t=[],n={"`":"~",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")","-":"_","=":"+",";":": ","'":'"',",":"<",".":">","/":"?","\\":"|","[":"{","]":"}"},o={109:"-",110:"del",111:"/",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},r=e.which,i={8:"backspace",9:"tab",13:"enter",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",91:"win",92:"win",93:"select",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"}[r]||String.fromCharCode(r).toLowerCase();(e.ctrlKey||e.metaKey)&&t.push("ctrl"),e.altKey&&t.push("alt"),e.shiftKey&&(t.push("shift"),o[r]?i=o[r]:n[i]&&(i=n[i])),i&&(r<16||18<r)&&t.push(i),t=t.join("+"),I[t]&&!1===I[t].call(z)&&(e.stopPropagation(),e.preventDefault())},z.addShortcut=function(e,t){return e=e.toLowerCase(),ye(t)?I[e]=function(){return P(ge[t],z.commands[t]),!1}:I[e]=t,z},z.removeShortcut=function(e){return delete I[e.toLowerCase()],z},te=function(e){var t,n,o;if(!_.disableBlockRemove&&8===e.which&&(o=g.selectedRange())&&(t=o.startContainer,0===o.startOffset)&&(n=pe())&&!Ve(n,"body,p")){for(;t!==n;){for(;t.previousSibling;)if((t=t.previousSibling).nodeType!==Ce||t.nodeValue)return;if(!(t=t.parentNode))return}(o=(o=Te(n,".interactive-box"))||Te(n,".sce-noempty-block"))&&ke(o),z.clearBlockFormatting(n),e.preventDefault()}},pe=function(){for(var e=y;!ct(e)||qe(e,!0);)if(!(e=e.parentNode)||Ve(e,"body"))return;return e},z.clearBlockFormatting=function(e){if((e=e||pe())&&!Ve(e,"body")){g.saveRange(),p=null,Re(e,"class"),Re(e,"style"),Re(e,"data-bbcode"),Re(e,"data-title");for(var t=e.attributes.length-1;0<=t;t--)0===e.attributes[t].name.indexOf("data-")&&Re(e,e.attributes[t].name);Ve(e,"p,div,td")||st(e,"p"),g.restoreRange()}return z},N=function(e){var t,n,o;(z.wrapper.hasHandler("eventSceditorValuechanged")||N.hasHandler)&&(o=!(n=z.sourceMode())&&g.hasSelection(),e=(m=!1)!==e&&!d.getElementById("sceditor-start-marker"),h&&(clearTimeout(h),h=!1),o&&e&&g.saveRange(),(t=n?s.value:f.innerHTML)!==N.lastVal&&(N.lastVal=t,nt(w,"valuechanged",{rawValue:n?z.val():t})),o)&&e&&g.removeMarkers()},me=function(){h&&N()},D=function(e){var e=e.which,t=D.lastChar,n=13===t||32===t,t=8===t||46===t;D.lastChar=e,m||(13===e||32===e?n?D.triggerNext=!0:N():8===e||46===e?t?D.triggerNext=!0:N():D.triggerNext&&(N(),D.triggerNext=!1),clearTimeout(h),h=setTimeout(function(){m||N()},1500))},ie=function(e){(m=/start/i.test(e.type))||N()},he=function(){z.updateOriginal()},e()}Xe.formats={},Xe.icons={},Xe.command={get:function(e){return Fe[e]||null},set:function(e,t){return!(!e||!t)&&((t=Ge(Fe[e]||{},t)).remove=function(){Xe.command.remove(e)},Fe[e]=t,this)},remove:function(e){return Fe[e]&&delete Fe[e],this}},window.sceditor={command:Xe.command,commands:Fe,defaultOptions:pt,resizeTypes:Se,ie:p,ios:ht,isWysiwygSupported:gt,regexEscape:vt,escapeEntities:yt,escapeUriScheme:function(e){var t,n=window.location;return e&&/^[^\/]*:/i.test(e)&&!m.test(e)?((t=n.pathname.split("/")).pop(),n.protocol+"//"+n.host+t.join("/")+"/"+e):e},dom:{css:Ie,attr:ze,removeAttr:Re,is:Ve,closest:Te,createElement:Ee,width:Pe,height:$e,traverse:rt,rTraverse:it,parseHTML:at,hasStyling:ct,convertElement:st,blockLevelList:c,canHaveChildren:lt,isInline:qe,copyCSS:s,fixNesting:ut,findCommonAncestor:function(e,t){for(;e=e.parentNode;)if((n=e)!==(o=t)&&n.contains&&n.contains(o))return e;var n,o},getSibling:u,remove:ke,removeWhiteSpace:dt,extractContents:l,getOffset:ft,getStyle:d,hasStyle:function(e,t,n){return!!(e=d(e,t))&&(!n||e===n||Array.isArray(n)&&-1<n.indexOf(e))}},icons:Xe.icons,utils:{each:we,isEmptyObject:o,extend:Ge},formats:Xe.formats,create:function(e,t,n){t=t||{},Je(e,".sceditor-container")||(t.runWithoutWysiwygSupport||gt)&&new Xe(e,t,n)},instance:function(e){return e._sceditor}}})(cbbCore);

((R,e)=>{function c(e,t,n){var r,o,a,i,l,s="",c=e.startContainer,d=e.startOffset;for(c&&3!==c.nodeType&&(c=c.childNodes[d],d=0),a=i=d;n>s.length&&c&&3===c.nodeType;)r=c.nodeValue,o=n-s.length,l&&(i=r.length,a=0),l=c,c=t?(d=a=Math.max(i-o,0),s=r.substr(a,i-a)+s,l.previousSibling):(d=a+(i=Math.min(o,r.length)),s+=r.substr(a,i),l.nextSibling);return{node:l||c,offset:d,text:s}}var d=e.browser.msie&&e.browser.version<11;sceditor.RangeHelper=function(o,e){var a,r,i=e||o.contentDocument||o.document,l="sceditor-start-marker",s="sceditor-end-marker",h=this;h.insertHTML=function(e,t){var n,r;if(!h.selectedRange())return!1;for(t&&(e+=h.selectedHtml()+t),r=R.dom.createElement("p",{},i),n=i.createDocumentFragment(),r.innerHTML=e;r.firstChild;)n.appendChild(r.firstChild);h.insertNode(n)},r=function(e,t,n){var r,o=i.createDocumentFragment();if("string"==typeof e?(t&&(e+=h.selectedHtml()+t),o=R.dom.parseHTML(e)):(o.appendChild(e),t&&(o.appendChild(h.selectedRange().extractContents()),o.appendChild(t))),r=o.lastChild){for(;!R.dom.isInline(r.lastChild,!0);)r=r.lastChild;return R.dom.canHaveChildren(r)?r.lastChild||r.appendChild(document.createTextNode("​")):r=o,h.removeMarkers(),r.appendChild(a(l)),r.appendChild(a(s)),n?((e=R.dom.createElement("div")).appendChild(o),e.innerHTML):o}},h.insertNode=function(e,t){var e=r(e,t),t=h.selectedRange(),n=t.commonAncestorContainer;if(!e)return!1;t.deleteContents(),n&&3!==n.nodeType&&!R.dom.canHaveChildren(n)?n.parentNode.insertBefore(e,n):t.insertNode(e),h.restoreRange()},h.cloneSelected=function(){var e=h.selectedRange();if(e)return e.cloneRange()},h.selectedRange=function(){var e,t,n=o.getSelection();if(n){if(n.rangeCount<=0){for(t=i.body;t.firstChild;)t=t.firstChild;(e=i.createRange()).setStartBefore(t),n.addRange(e)}return e=0<n.rangeCount?n.getRangeAt(0):e}},h.hasSelection=function(){var e=o.getSelection();return e&&0<e.rangeCount},h.selectedHtml=function(){var e,t=h.selectedRange();return t?((e=R.dom.createElement("p",{},i)).appendChild(t.cloneContents()),e.innerHTML):""},h.parentNode=function(){var e=h.selectedRange();if(e)return e.commonAncestorContainer},h.getFirstBlockParent=function(e){function t(e){return R.dom.isInline(e,!0)?(e=e?e.parentNode:null)&&t(e):e}return t(e||h.parentNode())},h.insertNodeAt=function(e,t){var n=h.selectedRange(),r=h.cloneSelected();if(!r)return!1;r.collapse(e),r.insertNode(t),h.selectRange(n)},h.containsNodeText=function(e){for(var t,n,r,o=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){return NodeFilter.FILTER_ACCEPT}},!1);r=o.nextNode();)r.nodeValue&&(t||(t=r,console.log("Primero: "+r.nodeValue)),console.log("Ultimo: "+r.nodeValue),n=r);var a=h.selectedRange(),i=h.cloneSelected();return t?(i.setStart(t,0),i.setEnd(n,n.length)):i.selectNodeContents(e),a.compareBoundaryPoints(Range.START_TO_START,i)<1&&-1<a.compareBoundaryPoints(Range.END_TO_END,i)},h.selectNode=function(e){h.clear();var t=i.createRange();t.selectNodeContents(e),t.collapse(!1),h.selectRange(t)},a=function(e){h.removeMarker(e);e=R.dom.createElement("span",{id:e,className:"sceditor-selection sceditor-ignore",style:"display:none;line-height:0"},i);return e.innerHTML=" ",e},h.insertMarkers=function(){var e=h.selectedRange(),t=a(l);h.removeMarkers(),h.insertNodeAt(!0,t),e&&e.collapsed?t.parentNode.insertBefore(a(s),t.nextSibling):h.insertNodeAt(!1,a(s))},h.getMarker=function(e){return i.getElementById(e)},h.removeMarker=function(e){e=h.getMarker(e);e&&R.dom.remove(e)},h.removeMarkers=function(){h.removeMarker(l),h.removeMarker(s)},h.saveRange=function(){h.insertMarkers()},h.selectRange=function(e){var t,n=o.getSelection(),r=e.endContainer;if(!d&&e.collapsed&&r&&!R.dom.isInline(r,!0)){for(t=r.lastChild;t&&R.dom.is(t,".sceditor-ignore");)t=t.previousSibling;R.dom.is(t,"br")&&((r=i.createRange()).setEndAfter(t),r.collapse(!1),h.compare(e,r))&&(e.setStartBefore(t),e.collapse(!0))}n&&(h.clear(),n.addRange(e))},h.restoreRange=function(){var e,t=h.selectedRange(),n=h.getMarker(l),r=h.getMarker(s);if(!n||!r||!t)return!1;e=n.nextSibling===r,(t=i.createRange()).setStartBefore(n),t.setEndAfter(r),e&&t.collapse(!0),h.selectRange(t),h.removeMarkers()},h.selectOuterText=function(e,t){var n=h.cloneSelected();if(!n)return!1;n.collapse(!1),e=c(n,!0,e),t=c(n,!1,t),n.setStart(e.node,e.offset),n.setEnd(t.node,t.offset),h.selectRange(n)},h.getOuterText=function(e,t){var n=h.cloneSelected();return n?(n.collapse(!e),c(n,e,t).text):""},h.replaceKeyword=function(e,t,n,r,o,a){n||e.sort(function(e,t){return e[0].length-t[0].length});var i,l,s,c,d,u,g,f="(^|[\\s    ])",m=e.length,p=o?1:0,n=r||e[m-1][0].length;for(o&&n++,a=a||"",c=(i=h.getOuterText(!0,n)).length,i+=a,t&&(i+=h.getOuterText(!1,n));m--;)if(g=(u=e[m][0]).length,s=Math.max(0,c-g-p),l=-1,o?(d=i.substr(s).match(new RegExp(f+R.regexEscape(u)+f)))&&(l=d.index+s+d[1].length):l=i.indexOf(u,s),-1<l&&l<=c&&c<=l+g+p)return h.selectOuterText(d=c-l,g-d-(/^\S/.test(a)?1:0)),h.insertHTML(e[m][1]),!0;return!1},h.compare=function(e,t){return t=t||h.selectedRange(),e&&t?0===e.compareBoundaryPoints(Range.END_TO_END,t)&&0===e.compareBoundaryPoints(Range.START_TO_START,t):!e&&!t},h.clear=function(){var e=o.getSelection();e&&(e.removeAllRanges?e.removeAllRanges():e.empty&&e.empty())}}})(sceditor,cbbCore);

(a=>{var r=a.dom;a.icons.phpbb=function(){var o={};return{create:function(e){if(e in a.icons.phpbb.icons){var i=a.icons.phpbb.icons[e];if(i)return 0===i.indexOf("<")?o[e]=a.dom.parseHTML(i).firstChild:0===i.indexOf("fa-")?o[e]=a.dom.parseHTML('<i class="fa '+i+'"></i>').firstChild:o[e]=a.dom.parseHTML('<img src="'+i+'" alt="" />').firstChild,o[e]}return!1},update:function(e,i){!e&&i&&o.color&&(e=i.ownerDocument.queryCommandValue("forecolor"),parseInt(e)===e&&(e="#"+("000000"+(e=(255&e)<<16|65280&e|(16711680&e)>>>16).toString(16)).slice(-6)),r.css(o.color.querySelector(".sce-color"),"fill",e))},rtl:function(e){var i=o.grip;i&&(r.css(i,"transform",e=e?"scaleX(-1)":""),r.css(i,"msTransform",e),r.css(i,"webkitTransform",e))}}},a.icons.phpbb.icons={bold:"fa-bold",bulletlist:"fa-list-ul",code:"fa-code",color:'<svg xmlns="http://www.w3.org/2000/svg" viewbox="1 1 22 22" unselectable="on"><path d="M9.62,12L12,5.67L14.37,12M11,3L5.5,17H7.75L8.87,14H15.12L16.25,17H18.5L13,3H11Z" /><path class="sce-color" d="M0,24H24V20H0V24Z" /></svg>',date:"fa-calendar",emoticon:"fa-smile-o",format:'<svg xmlns="http://www.w3.org/2000/svg" viewbox="1 1 22 22" unselectable="on"><path d="M18,4V3A1,1 0 0,0 17,2H5A1,1 0 0,0 4,3V7A1,1 0 0,0 5,8H17A1,1 0 0,0 18,7V6H19V10H9V21A1,1 0 0,0 10,22H12A1,1 0 0,0 13,21V12H21V4H18Z" /></svg>',image:"fa-image",italic:"fa-italic",justify:"fa-align-justify",link:"fa-link",maximize:"fa-expand",orderedlist:"fa-list-ol",print:"fa-print",quote:"fa-quote-right",removeformat:"fa-eraser",size:"fa-text-height",source:"fa-file-o",strike:"fa-strikethrough",time:"fa-clock-o",underline:"fa-underline",unlink:"fa-unlink"}})((document,sceditor));

((e,a,c)=>{var g=e.escapeEntities,r=e.escapeUriScheme,p=e.dom,t=e.utils,h=p.css,m=p.attr,v=p.is,n=t.extend,b=t.each,y=(t=e.ie)&&t<11,k="data-sceditor-emoticon",i=e.command.get,B={always:1,never:2,auto:3},o={bold:{txtExec:["[b]","[/b]"]},italic:{txtExec:["[i]","[/i]"]},underline:{txtExec:["[u]","[/u]"]},size:{txtExec:function(e){var n=this;i("size")._dropDown(n,e,function(e){var t=n.sourceEditorCaret(),e=n.wrapper.insertBBcodeInText("size",e,n.val(),t);n.val(e),n.sourceEditorCaret(t)})}},color:{txtExec:function(e){var n=this;i("color")._dropDown(n,e,function(e){var t=n.sourceEditorCaret(),e=n.wrapper.insertBBcodeInText("color",e,n.val(),t);n.val(e),n.sourceEditorCaret(t)})}},removeformat:{txtExec:function(e,t){t&&this.insertText(this.wrapper.clearBBcode(t))}},bulletlist:{txtExec:function(e,t){var n=[];t&&b(t.split(/\r?\n/),function(){n.push(this)}),this.insertText("[list]\n[*]"+n.join("\n[*]")+"\n[/list]")}},orderedlist:{txtExec:function(e,t){var n=[];t&&b(t.split(/\r?\n/),function(){n.push(this)}),this.insertText("[list=1]\n[*]"+n.join("\n[*]")+"\n[/list]")}},code:{txtExec:["[code]","[/code]"]},image:{txtExec:function(e){var t=this;i("image")._dropDown(t,e,function(e){if(e.link)return t.wrapper.insertBBcode("img",{inner:e.link},0,t.getSource()),!0})}},link:{txtExec:function(e,t){var n=this;i("link")._dropDown(n,e,function(e){if(e.link)return n.wrapper.insertBBcode("url",{defaultAttr:e.link,inner:e.desc||t||e.link},0,n.getSource()),!0})}},quote:{txtExec:function(e){var n=this;i("quote")._dropDown(n,e,function(e){var t;return e.date&&(t=Math.floor(new Date(e.date).getTime()/1e3)),n.wrapper.insertBBcode("quote",{defaultAttr:e.author,time:t}),!0})}}},x={b:{tags:{b:null,strong:null},styles:{"font-weight":["bold","bolder","401","700","800","900"]},format:"[b]{0}[/b]",html:"<strong>{0}</strong>"},i:{tags:{i:null,em:null},styles:{"font-style":["italic","oblique"]},format:"[i]{0}[/i]",html:"<em>{0}</em>"},u:{tags:{u:null},styles:{"text-decoration":["underline"]},format:"[u]{0}[/u]",html:"<u>{0}</u>"},size:{tags:{span:{"data-size":null}},format:function(e,t){var n=m(e,"data-size");return n&&m(e,"style")?"[size="+n+"]"+t+"[/size]":t},html:'<span data-size="{defaultattr}" style="font-size:{defaultattr}%;">{!0}</span>'},color:{tags:{font:{color:null}},styles:{color:null},quoteType:B.never,format:function(e,t){var n;return m(e,"data-bbcode")?t:"[color="+l(n=v(e,"font")&&(n=m(e,"color"))?n:e.style.color||h(e,"color"))+"]"+t+"[/color]"},html:function(e,t,n){return'<font color="'+g(l(t.defaultattr),!0)+'">'+n+"</font>"}},ul:{tags:{ul:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[list]{0}[/list]",html:"<ul>{0}</ul>"},list:{breakStart:!0,isInline:!1,skipLastLineBreak:!0,html:function(e,t,n){return t.defaultattr?"<ol>"+n+"</ol>":"<ul>"+n+"</ul>"}},ol:{tags:{ol:null},breakStart:!0,isInline:!1,skipLastLineBreak:!0,format:"[list=1]{0}[/list]",html:"<ol>{0}</ol>"},li:{tags:{li:null},isInline:!1,excludeClosing:!0,closedBy:["/ul","/ol","/list","*","li"],format:"[*]{0}",html:"<li>{0}</li>"},"*":{isInline:!1,excludeClosing:!0,closedBy:["/ul","/ol","/list","*","li"],html:"<li>{0}</li>"},emoticon:{allowsEmpty:!0,tags:{img:{src:null,"data-sceditor-emoticon":null}},format:function(e,t){return m(e,k)+t},html:"{0}"},img:{allowsEmpty:!0,tags:{img:{src:null}},allowedChildren:["#"],quoteType:B.never,format:function(e,t){return m(e,k)?t:"[img]"+m(e,"src")+"[/img]"},html:function(e,t,n){return'<img src="'+r(n)+'" />'}},url:{allowsEmpty:!0,tags:{a:{href:null}},quoteType:B.never,format:function(e,t){e=m(e,"href");return e==t?"[url]"+t+"[/url]":"[url="+e+"]"+t+"[/url]"},html:function(e,t,n){return t.defaultattr=g(t.defaultattr,!0)||n,'<a href="'+r(t.defaultattr)+'">'+n+"</a>"}},quote:{tags:{blockquote:null},isInline:!1,quoteType:B.always,format:function(e,t){for(var n,r="data-author",i={},o=e.children,l=0;!n&&l<o.length;l++)v(o[l],"cite")&&(n=o[l]);return(n||m(e,r))&&(i[""]=c.trim(n&&n.textContent||m(e,r)),n&&e.removeChild(n),t=this.elementToBbcode(e),c.each(["post_id","time","user_id"],function(){i[this]=m(e,"data-"+this)})),"[quote"+a.serializeVars(i," ")+"]"+t+"[/quote]"},html:function(e,t,n){var r,i={class:"uncited"};for(r in t)if(t[r])switch(r){case"defaultattr":n="<cite>"+g(t.defaultattr)+"</cite>"+n,i.class="";break;case"time":var o=new Date;o.setTime(1e3*a.intval(t[r])),i["data-time-formatted"]=o.toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"});default:i["data-"+r]=t[r]}return"<blockquote "+a.serializeVars(i," ")+">"+n+"</blockquote>"}},code:{tags:{code:null},isInline:!1,allowedChildren:["#","#newline"],format:function(e,t){if(e.hasAttributes())for(var n=0;e.attributes.length-1;n++)if(e.attributes[n].name.indexOf("data-sceditor-"))return t;return"[code]"+t+"[/code]"},html:function(e,t,n){return'<code data-title="'+a.lang("CODE")+':">'+n+"</code>"}},ignore:{}};function C(e,r){return e.replace(/\{([^}]+)\}/g,function(e,t){var n=!0;return"!"===t.charAt(0)&&(n=!1,t=t.substring(1)),"0"===t&&(n=!1),void 0===r[t]?e:n?g(r[t],!0):r[t]})}function w(e){return"function"==typeof e}function T(e){return e&&e.replace(/\\(.)/g,"$1").replace(/^(["'])(.*?)\1$/,"$2")}function E(e){var n=arguments;return e.replace(/\{(\d+)\}/g,function(e,t){return void 0!==n[+t+1]?n[+t+1]:"{"+t+"}"})}var S="open",I="content",L="newline",A="close";function s(e,t,n,r,i,o){var l=this;l.type=e,l.name=t,l.val=n,l.attrs=r||{},l.children=i||[],l.closing=o||null}function q(e){var h=this;function l(e,t){var n,r,i;return e===S&&(n=t.match(/\[([^\]\s=]+)(?:([^\]]+))?\]/))&&(i=o(n[1]),n[2])&&(n[2]=n[2].trim())&&(r=(e=>{var t,n=/([^\s=]+)=(?:(?:(["'])((?:\\\2|[^\2])*?)\2)|((?:.(?!\s\S+=))*.))/g,r={};if("="===e.charAt(0)&&e.indexOf("=",1)<0)r.defaultattr=T(e.substr(1));else for("="===e.charAt(0)&&(e="defaultattr"+e);t=n.exec(e);)r[o(t[1])]=T(t[3])||t[4];return r})(n[2])),e===A&&(n=t.match(/\[\/([^\[\]]+)\]/))&&(i=o(n[1])),(i=e===L?"#newline":i)&&(e!==S&&e!==A||x[i])||(e=I,i="#"),new s(e,i,t,r)}function d(e,t,n){for(var r=n.length;r--;)if(n[r].type===t&&n[r].name===e)return 1}function p(e,t){e=(e?x[e.name]:{}).allowedChildren;return!h.opts.fixInvalidChildren||!e||-1<e.indexOf(t.name||"#")}function m(e,t,n){var r=/\s|=/.test(e);return w(t)?t(e,n):t===B.never||t===B.auto&&!r?e:'"'+e.replace("\\","\\\\").replace('"','\\"')+'"'}function v(e){return e.length?e[e.length-1]:null}function o(e){return e.toLowerCase()}h.opts=n({},q.defaults,e),h.tokenize=function(e){var t,n,r,i=[],o=[{type:I,regex:/^([^\[\r\n]+|\[)/},{type:L,regex:/^(\r\n|\r|\n)/},{type:S,regex:/^\[[^\[\]]+\]/},{type:A,regex:/^\[\/[^\[\]]+\]/}];e:for(;e.length;){for(r=o.length;r--;)if(n=o[r].type,(t=e.match(o[r].regex))&&t[0]){i.push(l(n,t[0])),e=e.substr(t[0].length);continue e}e.length&&i.push(l(I,e)),e=""}return i},h.parse=function(e,t){var e=(e=>{function t(){return v(f)}function n(e){(t()?t().children:u).push(e)}function r(e){return t()&&(o=x[t().name])&&o.closedBy&&-1<o.closedBy.indexOf(e)}for(var i,o,l,a,s,c=[],u=[],f=[];i=e.shift();)switch(s=e[0],p(t(),i)||i.type===A&&t()&&i.name===t().name||(i.name="#",i.type=I),i.type){case S:r(i.name)&&f.pop(),n(i),(o=x[i.name])&&!o.isSelfClosing&&(o.closedBy||d(i.name,A,e))?f.push(i):o&&o.isSelfClosing||(i.type=I);break;case A:if(t()&&i.name!==t().name&&r("/"+i.name)&&f.pop(),t()&&i.name===t().name)t().closing=i,f.pop();else if(d(i.name,S,f)){for(;l=f.pop();){if(l.name===i.name){l.closing=i;break}l=l.clone(),c.length&&l.children.push(v(c)),c.push(l)}for(s&&s.type===L&&(o=x[i.name])&&!1===o.isInline&&(n(s),e.shift()),n(v(c)),a=c.length;a--;)f.push(c[a]);c.length=0}else i.type=I,n(i);break;case L:t()&&s&&r((s.type===A?"/":"")+s.name)&&(s.type===A&&s.name===t().name||((o=x[t().name])&&o.breakAfter||o&&!1===o.isInline&&h.opts.breakAfterBlock&&!1!==o.breakAfter)&&f.pop()),n(i);break;default:n(i)}return u})(h.tokenize(e)),n=h.opts;return n.fixInvalidNesting&&function e(t,n,r,i){var o,l,a,s;var c=function(e){e=x[e.name];return!e||!1!==e.isInline};n=n||[];i=i||t;for(l=0;l<t.length;l++)if((o=t[l])&&o.type===S){var u,f;if(r&&!c(o))if(f=v(n),s=f.splitAt(o),a=1<n.length?n[n.length-2].children:i,p(o,f)&&((u=f.clone()).children=o.children,o.children=[u]),-1<(u=a.indexOf(f)))return s.children.splice(0,1),a.splice(u+1,0,o,s),void((f=s.children[0])&&f.type===L&&!c(o)&&(s.children.splice(0,1),a.splice(u+2,0,f)));n.push(o),e(o.children,n,r||c(o),i),n.pop()}}(e),function e(t,n,r){var i,o,l,a,s,c,u,f;var d=t.length;n&&(a=x[n.name]);var p=d;for(;p--;)(i=t[p])&&(i.type===L?(o=0<p?t[p-1]:null,l=p<d-1?t[p+1]:null,f=!1,!r&&a&&!0!==a.isSelfClosing&&(o?c||l||(!1===a.isInline&&h.opts.breakEndBlock&&!1!==a.breakEnd&&(f=!0),a.breakEnd&&(f=!0),c=f):(!1===a.isInline&&h.opts.breakStartBlock&&!1!==a.breakStart&&(f=!0),a.breakStart&&(f=!0))),o&&o.type===S&&(s=x[o.name])&&(r?!1===s.isInline&&(f=!0):(!1===s.isInline&&h.opts.breakAfterBlock&&!1!==s.breakAfter&&(f=!0),s.breakAfter&&(f=!0))),!r&&!u&&l&&l.type===S&&(s=x[l.name])&&(!1===s.isInline&&h.opts.breakBeforeBlock&&!1!==s.breakBefore&&(f=!0),s.breakBefore&&(f=!0),u=f)?t.splice(p,1):(f&&t.splice(p,1),u=!1)):i.type===S&&e(i.children,i,r))}(e,null,t),n.removeEmptyTags&&function e(t){var n,r;var i=function(e){for(var t=e.length;t--;){var n=e[t].type;if(n===S||n===A)return!1;if(n===I&&/\S|\u00A0/.test(e[t].val))return!1}return!0};var o=t.length;for(;o--;)(n=t[o])&&n.type===S&&(r=x[n.name],e(n.children),i(n.children))&&r&&!r.isSelfClosing&&!r.allowsEmpty&&t.splice.apply(t,[o,1].concat(n.children))}(e),e},h.customBBcodes=function(e,t){switch(t){case"bbcode":var n=c("<div />").append(e.innerHTML);n.find("thead, tbody").each(function(){c(this).replaceWith(this.innerHTML)}),n.find(".codebox").each(function(){c(this).replaceWith(c(this).find("code").clone())}),n.find("*").each(function(){for(var e in h.opts.customBBcodes){var n,t,r=h.opts.customBBcodes[e];(n=r.tpl.exp.exec(this.outerHTML))&&(t=(t=r.source.input.replace(/\{([a-z0-9\_]+)(?:;optional)?\}/gi,function(e,t){t=c.inArray(t,r.tpl.keyMap);return-1!=t?c.trim(n[t+1]):""})).replace(e+"=]",e+"]"),c(this).replaceWith(t))}}),e.innerHTML=n.html();break;case"html":var r=h.opts.customBBcodes[e.token.name],i=void 0!==r;if(i){var o,l,a={};for(l in e.attrs)if(r.source.attrs[l]){if(!(o=e.attrs[l].match(r.source.attrs[l].exp))){i=!1;break}for(var s=1;s<o.length;s++)a[r.source.attrs[l].keyMap[s-1]]=o[s]}if(o=e.content.match(r.source.content.exp))for(s=1;s<o.length;s++)a[r.source.content.keyMap[s-1]]=o[s];else i=!1}return i?r.tpl.input.replace(/\{([a-z0-9\_]+)\}/gi,function(e,t){return a[t]||" "}):e.token.val+e.content+e.token.closing.val}return"string"==typeof e?"":e},h.toHTML=function(e,t){return function e(t,n){var r,i,o,l,a,s,c,u,f=[];c=function(e){return!1!==(!e||(e.isHtmlInline!==r?e.isHtmlInline:e.isInline))};for(;0<t.length;)if(i=t.shift()){if(i.type===S)u=i.children[i.children.length-1]||{},o=x[i.name],a=n===r&&c(o),l=e(i.children,i),u=o&&o.html?(c(o)||!c(x[u.name])||o.isPreFormatted||o.skipLastLineBreak||y||(l+="<br />"),w(o.html)?o.html.call(h,i,i.attrs,l):(i.attrs[0]=l,C(o.html,i.attrs))):i.val+l+(i.closing?i.closing.val:"");else{if(i.type===L){if(n!==r){p(n,i)&&f.push("<br />");continue}s||f.push("<div>"),y||f.push("<br />"),t.length||f.push("<br />"),f.push("</div>\n"),s=!1;continue}a=n===r,p(n,{name:L})||(i.val=i.val.replace(/[\r\n\t]+/,"")),u=g(i.val,!0)}a&&!s?(f.push("<div>"),s=!0):!a&&s&&(f.push("</div>\n"),s=!1),f.push(u)}s&&f.push("</div>\n");return f.join("")}(h.parse(e,t))},h.toBBCode=function(e,t){return function e(t){var n,r,i,o,l,a,s,c,u,f=[];for(;0<t.length;)if(n=t.shift())if(i=x[n.name],u=!(!i||!1!==i.isInline),o=i&&i.isSelfClosing,a=u&&h.opts.breakBeforeBlock&&!1!==i.breakBefore||i&&i.breakBefore,s=u&&!o&&h.opts.breakStartBlock&&!1!==i.breakStart||i&&i.breakStart,c=u&&h.opts.breakEndBlock&&!1!==i.breakEnd||i&&i.breakEnd,u=u&&h.opts.breakAfterBlock&&!1!==i.breakAfter||i&&i.breakAfter,l=(i?i.quoteType:null)||h.opts.quoteType||B.auto,i||n.type!==S)if(n.type===S){if(a&&f.push("\n"),f.push("["+n.name),n.attrs)for(r in n.attrs.defaultattr&&(f.push("=",m(n.attrs.defaultattr,l,"defaultattr")),delete n.attrs.defaultattr),n.attrs)n.attrs.hasOwnProperty(r)&&f.push(" ",r,"=",m(n.attrs[r],l,r));f.push("]"),s&&f.push("\n"),n.children&&f.push(e(n.children)),o||i.excludeClosing||(c&&f.push("\n"),f.push("[/"+n.name+"]")),u&&f.push("\n"),n.closing&&o&&f.push(n.closing.val)}else f.push(n.val);else f.push(n.val),n.children&&f.push(e(n.children)),n.closing&&f.push(n.closing.val);return f.join("")}(h.parse(e,t))}}function l(e){return a.colorToHex(e)}function u(){var s=this,l=(s.stripQuotes=T,{}),a={},u={ul:["li","ol","ul"],ol:["li","ol","ul"],table:["tr"],tr:["td","th"],code:["br","p","div"]};function f(n,r,e){var i,o,l=p.getStyle;return a[e=!!e]&&b(a[e],function(e,t){(i=l(n,e))&&l(n.parentNode,e)!==i&&b(t,function(e,t){(!t||-1<t.indexOf(i.toString()))&&(o=x[e].format,r=w(o)?o.call(s,n,r):E(o,r))})}),r}function d(n,r,e){var i,o,t=n.nodeName.toLowerCase();return e=!!e,l[t]&&l[t][e]&&b(l[t][e],function(e,t){t&&(i=!1,b(t,function(e,t){if(m(n,e)&&!(t&&t.indexOf(m(n,e))<0))return!(i=!0)}),!i)||(o=x[e].format,r=w(o)?o.call(s,n,r):E(o,r))}),r}function c(e){function c(e,a){var s="";return p.traverse(e,function(e){var t="",n=e.nodeType,r=e.nodeName.toLowerCase(),i=u[r],o=e.firstChild,l=!0;"object"!=typeof a||(l=-1<a.indexOf(r),l=!(!v(e,"img")||!m(e,k))||l)||(i=a),3!==n&&1!==n||(1===n?v(e,".sceditor-nlf")&&(!o||!y&&1===e.childNodes.length&&/br/i.test(o.nodeName))||("iframe"!==r&&(t=c(e,i)),l?("code"!==r&&(t=f(e,t),t=f(e,t=d(e,t),!0)),t=d(e,t,!0),s+=((e,t)=>{var n=e.nodeName.toLowerCase(),r=p.isInline;if(!r(e,!0)||"br"===n){for(var i,o,l=e.previousSibling;l&&1===l.nodeType&&!v(l,"br")&&r(l,!0)&&!l.firstChild;)l=l.previousSibling;for(;i=((o=e.parentNode)&&o.lastChild)===e,(e=o)&&i&&r(o,!0););(!i||"li"===n||"br"===n&&y)&&(t+="\n"),"br"!==n&&l&&!v(l,"br")&&r(l,!0)&&(t="\n"+t)}return t})(e,t)):s+=t):s+=e.nodeValue)},!1,!0),s}return c(e)}function e(e,t,n){var r,i,t=new q(s.opts.parserOptions).toHTML(s.opts.bbcodeTrim?t.trim():t);return e||n?(e=t,i=document.createElement("div"),n=function(e,t){if(!p.hasStyling(e)){if(y||1!==e.childNodes.length||!v(e.firstChild,"br"))for(;r=e.firstChild;)i.insertBefore(r,e);t&&e!==(t=i.lastChild)&&v(t,"div")&&e.nextSibling===t&&i.insertBefore(document.createElement("br"),e),i.removeChild(e)}},h(i,"display","none"),i.innerHTML=e.replace(/<\/div>\n/g,"</div>"),(e=i.firstChild)&&v(e,"div")&&n(e,!0),(e=i.lastChild)&&v(e,"div")&&n(e),i.innerHTML):t}function t(e,t,n,r){var i,o=(n=n||document).createElement("div"),l=n.createElement("div"),a=new q(s.opts.parserOptions);for(l.innerHTML=t,h(o,"visibility","hidden"),o.appendChild(l),n.body.appendChild(o),e&&(o.insertBefore(n.createTextNode("#"),o.firstChild),o.appendChild(n.createTextNode("#"))),r&&h(l,"whiteSpace",h(r,"whiteSpace")),i=l.getElementsByClassName("sceditor-ignore");i.length;)i[0].parentNode.removeChild(i[0]);return p.removeWhiteSpace(o),t=c(l=a.customBBcodes(l,"bbcode")),n.body.removeChild(o),t=a.toBBCode(t,!0),t=s.opts.bbcodeTrim?t.trim():t}s.init=function(){s.opts=this.opts,s.elementToBbcode=c,s.wrapper=this.wrapper,b(x,function(n){var r,e=x[n].tags,t=x[n].styles;e&&b(e,function(e,t){r=!1===x[n].isInline,l[e]=l[e]||{},l[e][r]=l[e][r]||{},l[e][r][n]=t}),t&&b(t,function(e,t){r=!1===x[n].isInline,a[r]=a[r]||{},a[r][e]=a[r][e]||{},a[r][e][n]=t})}),this.commands=n(!0,{},o,this.commands),this.toBBCode=s.toSource,this.fromBBCode=s.toHtml},s.toHtml=e.bind(null,!1),s.fragmentToHtml=e.bind(null,!0),s.toSource=t.bind(null,!1),s.fragmentToSource=t.bind(null,!0)}s.prototype={clone:function(){var e=this;return new s(e.type,e.name,e.val,n({},e.attrs),[],e.closing?e.closing.clone():null)},splitAt:function(e){var t,n=this.clone(),e=this.children.indexOf(e);return-1<e&&(t=this.children.length-e,n.children=this.children.splice(e,t)),n}},q.QuoteType=B,q.defaults={breakBeforeBlock:!1,breakStartBlock:!1,breakEndBlock:!1,breakAfterBlock:!0,removeEmptyTags:!0,fixInvalidNesting:!0,fixInvalidChildren:!0,quoteType:B.auto,customBBcodes:{}},u.get=function(e){return x[e]||null},u.set=function(e,t){return e&&t&&((t=n(x[e]||{},t)).remove=function(){delete x[e]},x[e]=t),this},u.rename=function(e,t){return e in x&&(x[t]=x[e],delete x[e]),this},u.remove=function(e){return e in x&&delete x[e],this},u.formatBBCodeString=C,e.formats.phpbb=u,e.BBCodeParser=q})(sceditor,cbbCore,jQuery);