/**
 * @package cBB Reactions
 * @version 1.0.4 01/04/2025
 *
 * @copyright (c) 2025 CaniDev
 * @license https://creativecommons.org/licenses/by-nc/4.0/
 */
((t,o,n)=>{"function"==typeof define&&define.amd?define(["jquery"],function(e){return n(e,t,o),e.mobile}):n(t.jQuery,t,o)})(this,document,function(e,a,K,O){var t;t=function(e){return e.ui=e.ui||{},e.ui.version="1.12.1"},"function"==typeof define&&define.amd?define("jquery-ui/version",["jquery"],t):t(e),t=function(){},"function"==typeof define&&define.amd&&define("core",["./defaults","./data","./helpers"],t),t=function(e){var t={touch:"ontouchend"in K};return e.mobile={},e.mobile.support=e.mobile.support||{},e.extend(e.support,t),e.extend(e.mobile.support,t),e.support},"function"==typeof define&&define.amd?define("support/touch",["jquery","../ns"],t):t(e),t=function(e){return e.extend(e.support,{orientation:"orientation"in a&&"onorientationchange"in a}),e.support},"function"==typeof define&&define.amd?define("support/orientation",["jquery"],t):t(e),t=function(p){var c,e,i="virtualMouseBindings",u="virtualTouchID",l="clientX clientY pageX pageY screenX screenY".split(" "),t="vmouseover vmousedown vmousemove vmouseup vclick vmouseout vmousecancel".split(" "),f="altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),o=p.event.mouseHooks?p.event.mouseHooks.props:[],h=f.concat(o),a={},n=0,s=0,r=0,v=!1,d=[],m=!1,g=!1,w="addEventListener"in K,T=p(K),y=1,b=0;function D(e){for(;e&&void 0!==e.originalEvent;)e=e.originalEvent;return e}function P(e){for(var t,o,n={};e;){for(o in t=p.data(e,i))t[o]&&(n[o]=n.hasVirtualBinding=!0);e=e.parentNode}return n}function k(){g=!0}function E(){b=0,d.length=0,m=!1,k()}function F(){g=!1}function X(){n&&(clearTimeout(n),n=0)}function Y(){X(),n=setTimeout(function(){n=0,E()},p.vmouse.resetTimerDuration)}function x(e,t,o){var n;return(o&&o[e]||!o&&((e,t)=>{for(var o;e;){if((o=p.data(e,i))&&(!t||o[t]))return e;e=e.parentNode}})(t.target,e))&&(n=((e,t)=>{var o,n,i,a,s,r,c,u=e.type;if((e=p.Event(e)).type=t,o=e.originalEvent,n=f,-1<u.search(/^(mouse|click)/)&&(n=h),o)for(s=n.length;s;)e[i=n[--s]]=o[i];if(-1<u.search(/mouse(down|up)|click/)&&!e.which&&(e.which=1),-1!==u.search(/^touch/)&&(u=(t=D(o)).touches,t=t.changedTouches,a=u&&u.length?u[0]:t&&t.length?t[0]:O))for(r=0,c=l.length;r<c;r++)e[i=l[r]]=a[i];return e})(t,e),p(t.target).trigger(n)),n}function M(e){var t=p.data(e.target,u);"click"===e.type&&"touchstart"===p.data(e.target,"lastTouchType")&&setTimeout(function(){"touchstart"===p.data(e.target,"lastTouchType")&&(E(),delete p.data(e.target).lastTouchType,M(e))},p.vmouse.maximumTimeBetweenTouches),m||b&&b===t||(t=x("v"+e.type,e))&&(t.isDefaultPrevented()&&e.preventDefault(),t.isPropagationStopped()&&e.stopPropagation(),t.isImmediatePropagationStopped())&&e.stopImmediatePropagation()}function I(e){var t,o=D(e).touches;o&&1===o.length&&(t=P(o=e.target),p.data(e.target,"lastTouchType",e.type),t.hasVirtualBinding)&&(b=y++,p.data(o,u,b),X(),F(),v=!1,o=D(e).touches[0],s=o.pageX,r=o.pageY,x("vmouseover",e,t),x("vmousedown",e,t))}function j(e){g||(v||x("vmousecancel",e,P(e.target)),p.data(e.target,"lastTouchType",e.type),v=!0,Y())}function q(e){var t,o,n,i;g||(t=D(e).touches[0],o=v,n=p.vmouse.moveDistanceThreshold,i=P(e.target),p.data(e.target,"lastTouchType",e.type),(v=v||Math.abs(t.pageX-s)>n||Math.abs(t.pageY-r)>n)&&!o&&x("vmousecancel",e,i),x("vmousemove",e,i),Y())}function S(e){var t,o;g||p.data(e.target,"lastTouchType")===O||(k(),delete p.data(e.target).lastTouchType,x("vmouseup",e,t=P(e.target)),v||(o=x("vclick",e,t))&&o.isDefaultPrevented()&&(o=D(e).changedTouches[0],d.push({touchID:b,x:o.clientX,y:o.clientY}),m=!0),x("vmouseout",e,t),v=!1,Y())}function B(e){var t,o=p.data(e,i);if(o)for(t in o)if(o[t])return 1}function L(){}for(p.vmouse={moveDistanceThreshold:10,clickDistanceThreshold:10,resetTimerDuration:1500,maximumTimeBetweenTouches:100},e=0;e<t.length;e++)p.event.special[t[e]]=(o=>{var n=o.substr(1);return{setup:function(){B(this)||p.data(this,i,{}),p.data(this,i)[o]=!0,a[o]=(a[o]||0)+1,1===a[o]&&T.on(n,M),p(this).on(n,L),w&&(a.touchstart=(a.touchstart||0)+1,1===a.touchstart)&&T.on("touchstart",I).on("touchend",S).on("touchmove",q).on("scroll",j)},teardown:function(){--a[o],a[o]||T.off(n,M),w&&(--a.touchstart,a.touchstart||T.off("touchstart",I).off("touchmove",q).off("touchend",S).off("scroll",j));var e=p(this),t=p.data(this,i);t&&(t[o]=!1),e.off(n,L),B(this)||e.removeData(i)}}})(t[e]);w&&K.addEventListener("click",function(e){var t,o,n,i,a,s=d.length,r=e.target;if(s)for(t=e.clientX,o=e.clientY,c=p.vmouse.clickDistanceThreshold,n=r;n;){for(i=0;i<s;i++)if(a=d[i],n===r&&Math.abs(a.x-t)<c&&Math.abs(a.y-o)<c||p.data(n,u)===a.touchID)return e.preventDefault(),void e.stopPropagation();n=n.parentNode}},!0)},"function"==typeof define&&define.amd?define("vmouse",["jquery"],t):t(e),t=function(u){var p=u(K),e=u.mobile.support.touch,o=e?"touchstart":"mousedown",r=e?"touchend":"mouseup",c=e?"touchmove":"mousemove";function l(e,t,o,n){var i=o.type;o.type=t,n?u.event.trigger(o,O,e):u.event.dispatch.call(e,o),o.type=i}return u.each("touchstart touchmove touchend tap taphold swipe swipeleft swiperight".split(" "),function(e,t){u.fn[t]=function(e){return e?this.on(t,e):this.trigger(t)},u.attrFn&&(u.attrFn[t]=!0)}),u.event.special.tap={tapholdThreshold:750,emitTapOnTaphold:!0,setup:function(){var s=this,r=u(s),c=!1;r.on("vmousedown",function(e){if(c=!1,e.which&&1!==e.which)return!0;var t,o,n=e.target;function i(){clearTimeout(t)}function a(){i(),r.off("vclick",o).off("vmouseup",i),p.off("vmousecancel",a)}o=function(e){a(),c||n!==e.target?c&&e.preventDefault():l(s,"tap",e)},r.on("vmouseup",i).on("vclick",o),p.on("vmousecancel",a),t=setTimeout(function(){u.event.special.tap.emitTapOnTaphold||(c=!0),t=0,l(s,"taphold",u.Event("taphold",{target:n}))},u.event.special.tap.tapholdThreshold)})},teardown:function(){u(this).off("vmousedown").off("vclick").off("vmouseup"),p.off("vmousecancel")}},u.event.special.swipe={scrollSupressionThreshold:30,durationThreshold:1e3,horizontalDistanceThreshold:2<=a.devicePixelRatio?15:30,verticalDistanceThreshold:2<=a.devicePixelRatio?15:30,getLocation:function(e){var t=a.pageXOffset,o=a.pageYOffset,n=e.clientX,i=e.clientY;return 0===e.pageY&&Math.floor(i)>Math.floor(e.pageY)||0===e.pageX&&Math.floor(n)>Math.floor(e.pageX)?(n-=t,i-=o):(i<e.pageY-o||n<e.pageX-t)&&(n=e.pageX-t,i=e.pageY-o),{x:n,y:i}},start:function(e){var t=e.originalEvent.touches?e.originalEvent.touches[0]:e,t=u.event.special.swipe.getLocation(t);return{time:(new Date).getTime(),coords:[t.x,t.y],origin:u(e.target)}},stop:function(e){e=e.originalEvent.touches?e.originalEvent.touches[0]:e,e=u.event.special.swipe.getLocation(e);return{time:(new Date).getTime(),coords:[e.x,e.y]}},handleSwipe:function(e,t,o,n){var i;return t.time-e.time<u.event.special.swipe.durationThreshold&&Math.abs(e.coords[0]-t.coords[0])>u.event.special.swipe.horizontalDistanceThreshold&&Math.abs(e.coords[1]-t.coords[1])<u.event.special.swipe.verticalDistanceThreshold&&(i=e.coords[0]>t.coords[0]?"swipeleft":"swiperight",l(o,"swipe",u.Event("swipe",{target:n,swipestart:e,swipestop:t}),!0),l(o,i,u.Event(i,{target:n,swipestart:e,swipestop:t}),!0),!0)},eventInProgress:!1,setup:function(){var a=this,e=u(a),s={},t=u.data(this,"mobile-events");t||u.data(this,"mobile-events",t={length:0}),t.length++,(t.swipe=s).start=function(e){var t,o,n,i;u.event.special.swipe.eventInProgress||(u.event.special.swipe.eventInProgress=!0,o=u.event.special.swipe.start(e),n=e.target,i=!1,s.move=function(e){o&&!e.isDefaultPrevented()&&(t=u.event.special.swipe.stop(e),i||(i=u.event.special.swipe.handleSwipe(o,t,a,n))&&(u.event.special.swipe.eventInProgress=!1),Math.abs(o.coords[0]-t.coords[0])>u.event.special.swipe.scrollSupressionThreshold)&&e.preventDefault()},s.stop=function(){i=!0,u.event.special.swipe.eventInProgress=!1,p.off(c,s.move),s.move=null},p.on(c,s.move).one(r,s.stop))},e.on(o,s.start)},teardown:function(){var e,t=u.data(this,"mobile-events");t&&(e=t.swipe,delete t.swipe,t.length--,0===t.length)&&u.removeData(this,"mobile-events"),e&&(e.start&&u(this).off(o,e.start),e.move&&p.off(c,e.move),e.stop)&&p.off(r,e.stop)}},u.each({taphold:"tap",swipeleft:"swipe.left",swiperight:"swipe.right"},function(e,t){u.event.special[e]={setup:function(){u(this).on(t,u.noop)},teardown:function(){u(this).off(t)}}}),u.event.special},"function"==typeof define&&define.amd?define("events/touch",["jquery","../vmouse","../support/touch"],t):t(e),t=function(s){var r="touchmove scroll";return s.each(["scrollstart","scrollstop"],function(e,t){s.fn[t]=function(e){return e?this.on(t,e):this.trigger(t)},s.attrFn&&(s.attrFn[t]=!0)}),s.event.special.scrollstart={enabled:!0,setup:function(){var n,t,i=this,e=s(i);function o(e,t){var o=e.type;n=t,e.type=n?"scrollstart":"scrollstop",s.event.dispatch.call(i,e),e.type=o}var a=s.event.special.scrollstart.handler=function(e){s.event.special.scrollstart.enabled&&(n||o(e,!0),clearTimeout(t),t=setTimeout(function(){o(e,!1)},50))};e.on(r,a)},teardown:function(){s(this).off(r,s.event.special.scrollstart.handler)}},s.each({scrollstop:"scrollstart"},function(e,t){s.event.special[e]={setup:function(){s(this).on(t,s.noop)},teardown:function(){s(this).off(t)}}}),s.event.special},"function"==typeof define&&define.amd?define("events/scroll",["jquery"],t):t(e)});

((i,a)=>{a.registerService("reactions",{options:{allowChange:!1,defaultID:0,simpleList:!1},__construct:function(){if(-1!=window.location.href.indexOf("adm/"))return this.initAdmin();this.options.defaultID=parseInt(this.options.defaultID),this.bindLauncher(),this.buildScoreLists()},bindLauncher:function(){var n=this;i(".reactions-launcher > a").cbbDropdown({class:"reactions-dropdown",dispatchCustom:!0,dispatchEvent:"hover",minSize:50,xPosition:"center",onCreate:function(){let e=this;this.container.find("[data-reaction-id]").on("click",function(t){t.preventDefault(),e.close(),a.request({url:e.element.attr("href"),data:{mode:"add_reaction",reaction:i(this).attr("data-reaction-id")},onSuccess:function(t){n.replaceContainers(t)}})})}}).off("contextmenu click mouseenter taphold").on({contextmenu:t=>{t.preventDefault()},click:function(t){t.preventDefault();let e=i(this),o=i(this).hasClass("default-icon");o&&n.options.defaultID?(e.cbbDropdown("close"),a.request({url:e.attr("href"),data:{mode:"add_reaction",reaction:n.options.defaultID},onSuccess:function(t){n.replaceContainers(t),a.browser.isMobile&&n.options.allowChange&&e.trigger("dropdown-contextmenu")}})):a.browser.isMobile&&o?i(this).trigger("dropdown-contextmenu"):!o&&n.options.allowChange&&a.request({url:this.href,data:{mode:"remove_reaction"},onSuccess:t=>{e.cbbDropdown("close"),n.replaceContainers(t)}})},mouseenter:function(){(i(this).hasClass("default-icon")||n.options.allowChange)&&i(this).trigger("dropdown-mouseenter")},taphold:function(t){if(a.browser.isMobile&&(i(this).hasClass("default-icon")||n.options.allowChange))return t.preventDefault(),i(this).trigger("dropdown-contextmenu"),!1}})},buildScoreLists:function(){var n=this;i(".reaction-score-list").each(function(){var t=n.getInheritBackground(i(this).parent()),e=0;i(i(this).find(".list-scores a").get().reverse()).each(function(){i(this).css({"border-color":t,"z-index":e}),e++})}),n.options.simpleList?i(".reaction-score-list .list-scores a").off("click").cbbDropdown({class:"reactions-view-list",dispatchEvent:"click",selector:"auto",yPosition:"top",onOpen:function(){let e=this;e.setContent(""),e.container.cbbLoading(!0,!1,!1,"reactions-loading"),a.request({url:e.element.attr("href"),onSuccess:t=>{e.container.objView(!1),e.setContent(t.htmlContent),setTimeout(()=>{e.container.objView(!0),e.setPosition("left","top")},100)}})}}):i(".reaction-score-list").find(".list-label a, .list-scores a").off("click").on("click",function(t){t.preventDefault(),i("<div></div>").cbbLoading(!0,!1,!0,"reactions-loading").cbbDialog({customClass:"cbb-dialog reactions-view-dialog",height:a.browser.isMobile?300:400,title:i(this).closest(".reaction-score-list").attr("data-title"),width:600,onOpen:function(){let o=this;function e(t){t&&o.find('.tab-header a[data-color=""]').each(function(){i(this).attr("data-color",i(this).css("color"))}),o.find(".tab-header a").removeStyle("color border-color").filter(".active").each(function(){var t=i(this).attr("data-color");t&&i(this).css({"border-color":t,color:t})})}a.request({url:t.currentTarget.href,onSuccess:t=>{o.find(".cbb-dialog-content").html(t.htmlContent),e(!0),o.find(".tab-header").on("wheel",function(t){i(this).scrollLeft(i(this).scrollLeft()+t.originalEvent.deltaY)}),o.find(".tab-header a").click(function(t){t.preventDefault(),i(this).addClass("active").siblings().removeClass("active"),e(),o.find(".tab-content").objView(!1).filter('[data-id="'+i(this).attr("data-id")+'"]').objView(!0)}),o.find('[data-ajaxify="custom"]').cbbAjaxify({onSuccess:function(t,e){"remove_reaction"==e.mode&&(o.find('[data-reaction="'+t.reactionID+'"][data-post="'+t.postID+'"][data-user="'+t.userID+'"]').fadeOut("fast",function(){i(this).remove()}),o.find('.tab-header [data-id="0"], .tab-header [data-id="'+t.reactionID+'"]').each(function(){var t=i(this).find(".tab-counter"),e=a.intval(t.text());t.text(Math.max(0,e-1))}),n.replaceContainers(t))}})},onFail:function(){o.cbbDialog("close")}})}})})},replaceContainers:function(t){t.button&&i('.reactions-launcher[data-post-id="'+t.postID+'"]').replaceWith(t.button),i('.reaction-score-list[data-post-id="'+t.postID+'"]').replaceWith(t.list),this.bindLauncher(),this.buildScoreLists()},initAdmin:function(){let t=i("form#acp_reactions"),e=!1,o=!1;i(".acp-reactions-table").sortable({disabled:i(".acp-reactions-table").children().length<2,handle:".handle",helper:function(t,e){let o=e.children(),n=e.clone();return n.children().each(function(t){i(this).width(o.eq(t).width())}),n},stop:function(){e&&!o&&(e=!1,o=!0,a.request({url:t.attr("action"),loadAssets:!1,data:i.extend({},t.serializeObject(),{action:"move"}),onComplete:function(){o=!1}}))},update:function(){e=!0}}).disableSelection(),i('.acp-reactions-table .column-actions a[data-request="ajax"]').cbbAjaxify({onSuccess:function(t,e){switch(e.action){case"delete":i("#reaction-"+t.reactionID).fadeOut("fast",function(){i(this).remove(),i(".acp-reactions-table").children().length||(i("#no-reactions-label").objView(!0),i(".acp-reactions-table").objView(!1))});break;case"set_default":i(".js-set-default").removeClass("active"),i("#reaction-"+t.reactionID+" .js-set-default").addClass("active")}}}),i('input[name="score"]').change(function(){var t="custom"==i(this).val();i('input[name="score_custom"]').objView(t),i('[name="config[reaction_score]"]').val(i(t?'[name="score_custom"]':this).val())}),i('[name="score_custom"]').on("input",function(){i('[name="config[reaction_score]"]').val(i(this).val())}),i(".reaction-color-selector button").cbbColorPicker({unique:!1,onRender:function(){this.cbbColorPicker("setColor",this.children(".color-preview").css("background-color"))},onChange:function(t){this.siblings("input").val(t),this.children(".color-preview").css("background-color",t)}}),i(".reaction-color-selector input").on("input",function(){let t=a.colorToHex(i(this).val());t=t||"rgba(0,0,0,0)",i(".reaction-color-selector .color-preview").css("background-color",t)}).trigger("input")},getInheritBackground:function(t){var e=t.css("background-color");return"rgba(0, 0, 0, 0)"!==e?e:t.is("body")?"rgba(0, 0, 0, 0)":this.getInheritBackground(t.parent())}},-1!=window.location.href.indexOf("adm/"))})(jQuery,cbbCore);